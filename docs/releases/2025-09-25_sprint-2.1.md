# Release Notes - Sprint 2.1 (Neukundengewinnung) - 2025-09-25

## Highlights
- Territory Management produktiv (keine geografische Lead-Sperre; nur Currency/Tax/Rules)
- Thread-sicherer `UserLeadSettingsService` mit echter Transaktionalität + Locking
- Lead-Protection (6M/60T/10T) als State-Machine; Stop-the-Clock umgesetzt
- CI grün, Coverage 85%+, Dev/Prod sauber getrennt

## Migrations
- **V229**: Territory & Lead Schema
- **V230**: Entfernen redundanter `updated_at`-Trigger (JPA als Single Source of Truth)
- **V231**: Join-Tabellen für `@ElementCollection` (`lead_collaborators`, `user_preferred_territories`) + PK/FK/Indizes

## DevOps & Sicherheit
- CORS nur im `%dev`-Profil (Vite 5173 ↔ Quarkus 8080)
- Fail-Closed in Production unverändert
- Toolchain auf LTS (Java 17/21) dokumentiert

## API
- Territories: GET mit ETag/304 vorbereitet; Mutationen mit If-Match (428/412) im Standard verankert
- Leads: CRUD + State-Transitions, Cache-Invalidierung bei Mutationen
- REST-konform mit korrekten HTTP-Status-Codes

## Qualität
- Lint/Format: Spotless
- Tests: Unit + Integration; Race-Condition-Case für Service abgedeckt
- Performance: API Response < 200ms P95 (gemessen)

## Bekannte Probleme (gelöst)
- ElementCollection Tables fehlten → V231 Migration behebt das Problem
- Race Condition bei statischen DB-Methoden → Service-Pattern mit CDI
- CORS-Blocking in Dev → Korrekte Dev-Profil-Konfiguration

## Referenzen
- PR #103 - Territory Management (gemerged)
- `docs/planung/TRIGGER_SPRINT_2_1.md` - Single Source of Truth
- Migration Scripts: `backend/src/main/resources/db/migration/V229-V231`