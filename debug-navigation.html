<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Navigation Debug</title>
    <link href="https://fonts.googleapis.com/css2?family=Antonio:wght@700&family=Poppins:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/variables.css">
    <link rel="stylesheet" href="/css/layout.css">
    <link rel="stylesheet" href="/css/components.css">
    <link rel="stylesheet" href="/css/header-logo.css">
    <link rel="stylesheet" href="/css/responsive.css">
    <style>
        #debug-output {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 400px;
            max-height: 400px;
            overflow-y: auto;
            background: #f0f0f0;
            border: 2px solid #333;
            padding: 20px;
            font-family: monospace;
            font-size: 12px;
            z-index: 9999;
            box-shadow: 0 0 10px rgba(0,0,0,0.3);
        }
        .debug-log {
            margin: 5px 0;
            padding: 5px;
            background: white;
            border-left: 3px solid #666;
        }
        .debug-error {
            border-left-color: red;
            background: #fee;
        }
        .debug-success {
            border-left-color: green;
            background: #efe;
        }
        .debug-info {
            border-left-color: blue;
            background: #eef;
        }
    </style>
</head>
<body>
    <!-- Copy of main HTML structure -->
    <div id="app">
        <header class="header">
            <div class="header-container">
                <div class="header-content">
                    <div class="logo">
                        <h1>FreshPlan Debug</h1>
                    </div>
                </div>
            </div>
        </header>

        <nav class="nav-container">
            <div class="nav-tabs" role="tablist">
                <button class="nav-tab active" data-tab="demonstrator" role="tab" aria-selected="true">
                    <span>Demonstrator</span>
                </button>
                <button class="nav-tab" data-tab="customer" role="tab" aria-selected="false">
                    <span>Kundendaten</span>
                </button>
                <button class="nav-tab" data-tab="profile" role="tab" aria-selected="false">
                    <span>Profil</span>
                </button>
                <button class="nav-tab" data-tab="offer" role="tab" aria-selected="false">
                    <span>Angebot</span>
                </button>
                <button class="nav-tab" data-tab="settings" role="tab" aria-selected="false">
                    <span>Einstellungen</span>
                </button>
            </div>
        </nav>

        <main class="main-container">
            <div class="tab-panels">
                <div id="demonstrator" class="tab-panel active" role="tabpanel">
                    <h2>Demonstrator Tab</h2>
                </div>
                <div id="customer" class="tab-panel" role="tabpanel">
                    <h2>Customer Tab</h2>
                </div>
                <div id="profile" class="tab-panel" role="tabpanel">
                    <h2>Profile Tab</h2>
                </div>
                <div id="offer" class="tab-panel" role="tabpanel">
                    <h2>Offer Tab</h2>
                </div>
                <div id="settings" class="tab-panel" role="tabpanel">
                    <h2>Settings Tab</h2>
                </div>
            </div>
        </main>
    </div>

    <div id="debug-output">
        <h3>Debug Output</h3>
    </div>

    <script type="module">
        const debug = document.getElementById('debug-output');
        
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `debug-log debug-${type}`;
            div.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            debug.appendChild(div);
            debug.scrollTop = debug.scrollHeight;
        }

        // Override console methods to capture output
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;

        console.log = (...args) => {
            originalLog.apply(console, args);
            log(args.join(' '), 'info');
        };

        console.error = (...args) => {
            originalError.apply(console, args);
            log(args.join(' '), 'error');
        };

        console.warn = (...args) => {
            originalWarn.apply(console, args);
            log(args.join(' '), 'info');
        };

        // Test basic functionality
        log('Starting navigation debug...', 'info');

        // Import and initialize the app
        import('./src/main.ts')
            .then(module => {
                log('Main module loaded successfully', 'success');
                
                // Wait for app initialization
                setTimeout(() => {
                    const app = window.FreshPlan?.app || window.FreshPlanApp;
                    
                    if (app) {
                        log(`App found: ${app.isInitialized ? 'initialized' : 'not initialized'}`, 'success');
                        
                        // Check modules
                        if (window.FreshPlan?.modules) {
                            log(`Modules found: ${Array.from(window.FreshPlan.modules.keys()).join(', ')}`, 'info');
                        }
                        
                        // Test tab navigation
                        const navButtons = document.querySelectorAll('.nav-tab');
                        log(`Found ${navButtons.length} navigation buttons`, 'info');
                        
                        // Add direct click handlers to test
                        navButtons.forEach((button, index) => {
                            button.addEventListener('click', (e) => {
                                log(`Direct click handler fired for tab: ${button.dataset.tab}`, 'success');
                            });
                        });
                        
                        // Try to get TabNavigationModule
                        const tabModule = window.FreshPlan?.getModule('tabs');
                        if (tabModule) {
                            log('TabNavigationModule found', 'success');
                            log(`Current tab: ${tabModule.getCurrentTab()}`, 'info');
                        } else {
                            log('TabNavigationModule not found', 'error');
                        }
                        
                    } else {
                        log('App not found in window', 'error');
                    }
                }, 1000);
            })
            .catch(error => {
                log(`Failed to load main module: ${error.message}`, 'error');
                console.error(error);
            });

        // Test direct DOM manipulation
        setTimeout(() => {
            log('Testing direct DOM manipulation...', 'info');
            
            const buttons = document.querySelectorAll('.nav-tab');
            const panels = document.querySelectorAll('.tab-panel');
            
            buttons.forEach(button => {
                button.addEventListener('click', function(e) {
                    const tab = this.dataset.tab;
                    log(`Manual click handler: switching to ${tab}`, 'info');
                    
                    // Remove active from all
                    buttons.forEach(b => {
                        b.classList.remove('active');
                        b.setAttribute('aria-selected', 'false');
                    });
                    panels.forEach(p => {
                        p.classList.remove('active');
                    });
                    
                    // Add active to clicked
                    this.classList.add('active');
                    this.setAttribute('aria-selected', 'true');
                    
                    const panel = document.getElementById(tab);
                    if (panel) {
                        panel.classList.add('active');
                        log(`Switched to ${tab} successfully`, 'success');
                    } else {
                        log(`Panel ${tab} not found`, 'error');
                    }
                });
            });
            
            log('Manual click handlers attached', 'success');
        }, 500);
    </script>
</body>
</html>