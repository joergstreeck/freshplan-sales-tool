# Test configuration - PostgreSQL via Testcontainers
quarkus.datasource.db-kind=postgresql
# DISABLE Dev Services for unit tests - we mock pg_notify
quarkus.datasource.devservices.enabled=false
quarkus.datasource.devservices.image-name=postgres:15-alpine
quarkus.datasource.devservices.db-name=freshplan-test
quarkus.datasource.devservices.username=test
quarkus.datasource.devservices.password=test

# Hibernate settings - Validate only (let Flyway handle schema)
quarkus.hibernate-orm.database.generation=validate

# Enable Flyway for integration tests
quarkus.flyway.migrate-at-start=true
quarkus.flyway.baseline-on-migrate=true
# Keep clean disabled to preserve test data
quarkus.flyway.clean-at-start=false
# Allow out-of-order migrations for test flexibility
quarkus.flyway.out-of-order=true
# Repair schema history if needed
quarkus.flyway.repair-at-start=true
# Nur noch Standard-Migrationen - keine SEED-Daten mehr
quarkus.flyway.locations=classpath:db/migration

# WICHTIG: Test-Daten werden Ã¼ber SQL-Migration V219 bereitgestellt
# Dies stellt sicher, dass immer Test-Kunden vorhanden sind

# DISABLE ALL SECURITY FOR TESTS - QUARKUS 3.17.4 SYSTEMATIC APPROACH

# 1. COMPLETELY DISABLE OIDC 
%test.quarkus.oidc.enabled=false
%test.quarkus.oidc.tenant-enabled=false

# 2. DISABLE ALL HTTP AUTHENTICATION
%test.quarkus.http.auth.proactive=false

# 3. DISABLE SECURITY ENTIRELY (if supported)
%test.quarkus.security.jaxrs.deny-unannotated-endpoints=false

# 4. PERMIT ALL PATHS
%test.quarkus.http.auth.permission.permit1.paths=/*
%test.quarkus.http.auth.permission.permit1.policy=permit

# 5. DISABLE DEFAULT SECURITY POLICIES
%test.quarkus.http.auth.policy.role-policy1.roles-allowed=**

# 6. COMPLETELY DISABLE OIDC CONFIGURATION (don't set empty values)
# OIDC is disabled via %test.quarkus.oidc.enabled=false - no other config needed
# Removed deprecated property

# Logging
quarkus.log.level=INFO
quarkus.log.category."de.freshplan".level=DEBUG
quarkus.log.category."org.flywaydb".level=DEBUG
quarkus.log.category."org.testcontainers".level=INFO
# DEBUG Security issues
quarkus.log.category."io.quarkus.security".level=DEBUG
quarkus.log.category."io.quarkus.oidc".level=DEBUG
quarkus.log.category."io.quarkus.vertx.http.runtime.security".level=DEBUG
quarkus.log.category."io.vertx.ext.web".level=DEBUG

# Disable automatic REST endpoint validation for tests
# Removed deprecated validator properties
%test.quarkus.hibernate-validator.fail-fast=false

# Disable endpoint validation completely for tests
# Removed deprecated validation property

# Disable audit validation in tests
%test.freshplan.audit.validation.enabled=false
%test.freshplan.audit.strict-mode=false

# RLS im Test deaktivieren
freshplan.security.rls.enabled=false
%test.freshplan.security.rls.enabled=false

# System user for tests
%test.security.rls.system-user=test-system@freshplan.de