<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FreshPlan Sales Tool</title>
    <!-- PDF Generation Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <style>
        /* Freshfoodz Brand Colors */
        :root {
            --primary-green: #7FB069;
            --light-green: #A8D89A;
            --dark-green: #5A8A4C;
            --text-dark: #333333;
            --text-light: #666666;
            --bg-light: #F5F5F5;
            --white: #FFFFFF;
            --success: #4CAF50;
            --warning: #FF9800;
            --danger: #F44336;
            --info: #2196F3;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            color: var(--text-dark);
            background-color: var(--bg-light);
            line-height: 1.6;
        }

        /* Header */
        .header {
            background-color: var(--white);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-green);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .logo::before {
            content: "ü•ó";
            font-size: 1.8rem;
        }

        /* Progress Indicator */
        .progress-bar {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 3px;
            background: var(--primary-green);
            transition: width 0.3s ease;
        }

        .nav-tabs {
            display: flex;
            gap: 2rem;
            flex-wrap: wrap;
            position: relative;
        }

        .nav-tab {
            padding: 0.5rem 1rem;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            white-space: nowrap;
            position: relative;
        }

        .nav-tab:hover {
            color: var(--primary-green);
        }

        .nav-tab.active {
            color: var(--primary-green);
            border-bottom-color: var(--primary-green);
        }

        .nav-tab.completed::after {
            content: "‚úì";
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--success);
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        /* Tooltip Styles */
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 250px;
            background-color: var(--text-dark);
            color: var(--white);
            text-align: left;
            border-radius: 6px;
            padding: 8px 12px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -125px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.875rem;
            line-height: 1.4;
        }

        .tooltip .tooltiptext::after {
            content: "";
            position: absolute;
            top: 100%;
            left: 50%;
            margin-left: -5px;
            border-width: 5px;
            border-style: solid;
            border-color: var(--text-dark) transparent transparent transparent;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        /* Autosave Indicator */
        .autosave-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--success);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            display: none;
            align-items: center;
            gap: 0.5rem;
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }

        .autosave-indicator.saving {
            background: var(--info);
        }

        .autosave-indicator.show {
            display: flex;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        /* Main Container */
        .main-container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 2rem;
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Card Styles */
        .card {
            background: var(--white);
            border-radius: 8px;
            padding: 2rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin-bottom: 2rem;
        }

        .card-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--text-dark);
            margin-bottom: 1.5rem;
        }

        /* Form Styles */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-dark);
        }

        input, select, textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary-green);
        }

        input.error, select.error, textarea.error {
            border-color: var(--danger);
        }

        .error-message {
            color: var(--danger);
            font-size: 0.875rem;
            margin-top: 0.25rem;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .required::after {
            content: " *";
            color: var(--danger);
        }

        .help-icon {
            display: inline-block;
            width: 16px;
            height: 16px;
            background: var(--info);
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 16px;
            font-size: 12px;
            cursor: help;
            margin-left: 0.25rem;
        }

        /* Button Styles */
        .btn {
            padding: 0.75rem 2rem;
            border: none;
            border-radius: 4px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-primary {
            background-color: var(--primary-green);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            background-color: var(--dark-green);
        }

        .btn-secondary {
            background-color: #f0f0f0;
            color: var(--text-dark);
        }

        .btn-secondary:hover:not(:disabled) {
            background-color: #e0e0e0;
        }

        /* Rabatt-Demonstrator Styles */
        .demonstrator-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        .demo-controls {
            background: var(--bg-light);
            padding: 2rem;
            border-radius: 8px;
        }

        .demo-results {
            background: linear-gradient(135deg, var(--primary-green), var(--dark-green));
            color: white;
            padding: 2rem;
            border-radius: 8px;
        }

        .slider-container {
            margin: 2rem 0;
        }

        .slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--primary-green);
            cursor: pointer;
        }

        .slider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: var(--primary-green);
            cursor: pointer;
            border: none;
        }

        .value-display {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-green);
            margin: 1rem 0;
        }

        .savings-box {
            background: rgba(255,255,255,0.2);
            padding: 1.5rem;
            border-radius: 8px;
            margin-top: 1rem;
        }

        .savings-amount {
            font-size: 2.5rem;
            font-weight: bold;
        }

        /* Toggle Switch */
        .toggle-container {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin: 1rem 0;
        }

        .toggle-switch {
            position: relative;
            width: 60px;
            height: 30px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 34px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 22px;
            width: 22px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--primary-green);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(30px);
        }

        /* Scenario Comparison */
        .scenario-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
        }

        .scenario-card {
            background: var(--white);
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }

        .scenario-card:hover {
            border-color: var(--primary-green);
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .scenario-title {
            font-weight: bold;
            color: var(--primary-green);
            margin-bottom: 1rem;
        }

        .scenario-details {
            font-size: 0.9rem;
            color: var(--text-light);
        }

        .scenario-savings {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary-green);
            margin-top: 1rem;
        }

        /* Customer Type Selection */
        .customer-type-selector {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .type-option {
            flex: 1;
            padding: 1.5rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
        }

        .type-option:hover {
            border-color: var(--primary-green);
        }

        .type-option.selected {
            border-color: var(--primary-green);
            background-color: rgba(127, 176, 105, 0.1);
        }

        /* Chain Management */
        .chain-quick-entry {
            background: var(--bg-light);
            padding: 2rem;
            border-radius: 8px;
            margin-top: 2rem;
        }

        .size-category {
            display: grid;
            grid-template-columns: 1fr 100px auto;
            gap: 1rem;
            align-items: center;
            margin-bottom: 1rem;
        }

        .number-input {
            width: 100%;
            text-align: center;
        }

        /* Language Switcher */
        .language-switcher {
            display: flex;
            gap: 0.5rem;
        }

        .lang-btn {
            padding: 0.5rem 1rem;
            border: 1px solid #ddd;
            background: white;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        .lang-btn.active {
            background: var(--primary-green);
            color: white;
            border-color: var(--primary-green);
        }

        /* Service Matrix for Chains */
        .service-matrix {
            margin-top: 1.5rem;
            padding: 1rem;
            background: white;
            border-radius: 8px;
        }

        .service-row {
            display: grid;
            grid-template-columns: 1fr 100px auto;
            gap: 1rem;
            align-items: center;
            margin-bottom: 0.5rem;
            padding: 0.5rem;
        }

        .service-row:hover {
            background: var(--bg-light);
            border-radius: 4px;
        }

        /* Calculation Result Box */
        .calc-result {
            background: var(--primary-green);
            color: white;
            padding: 2rem;
            border-radius: 8px;
            margin-top: 2rem;
        }

        .calc-breakdown {
            background: rgba(255,255,255,0.1);
            padding: 1rem;
            border-radius: 4px;
            margin: 1rem 0;
        }

        .calc-line {
            display: flex;
            justify-content: space-between;
            margin: 0.5rem 0;
        }

        /* PDF Preview Modal */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 2% auto;
            padding: 20px;
            border-radius: 8px;
            width: 90%;
            max-width: 1000px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover,
        .close:focus {
            color: black;
        }

        /* PDF Preview */
        .pdf-preview-frame {
            width: 100%;
            height: 600px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .demonstrator-container {
                grid-template-columns: 1fr;
            }
            
            .nav-tabs {
                gap: 1rem;
                font-size: 0.9rem;
            }
            
            .header-container {
                flex-direction: column;
                gap: 1rem;
            }
            
            .customer-type-selector {
                flex-direction: column;
            }
        }

        /* Loading Spinner */
        .spinner {
            border: 3px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top-color: var(--primary-green);
            width: 40px;
            height: 40px;
            animation: spin 1s ease-in-out infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Success/Error Messages */
        .message {
            padding: 1rem;
            border-radius: 4px;
            margin-bottom: 1rem;
            display: none;
        }

        .message.success {
            background-color: var(--success);
            color: white;
        }

        .message.error {
            background-color: var(--danger);
            color: white;
        }

        .message.show {
            display: block;
            animation: slideIn 0.3s ease;
        }

        /* Chain Detail View */
        .chain-detail-toggle {
            margin: 1rem 0;
        }

        .chain-locations-detail {
            display: none;
            margin-top: 1rem;
            padding: 1rem;
            background: white;
            border-radius: 8px;
        }

        .location-item {
            padding: 1rem;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            margin-bottom: 0.5rem;
        }

        .location-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
        }

        .location-details {
            display: none;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #e0e0e0;
        }

        /* Info Box */
        .info-box {
            background: rgba(127, 176, 105, 0.1);
            border-left: 4px solid var(--primary-green);
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 4px;
        }

        .info-box h4 {
            color: var(--dark-green);
            margin-bottom: 0.5rem;
        }

        /* Salesperson Section */
        .salesperson-section {
            background: var(--bg-light);
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
        }

        /* Customer Profile Styles */
        .profile-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        .profile-card {
            background: var(--bg-light);
            padding: 1.5rem;
            border-radius: 8px;
        }

        .profile-card h3 {
            color: var(--primary-green);
            margin-bottom: 1rem;
        }

        .profile-info-item {
            line-height: 1.8;
        }

        .potential-metrics {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .metric-item {
            display: flex;
            justify-content: space-between;
            padding: 0.75rem;
            background: white;
            border-radius: 4px;
        }

        .metric-value {
            font-weight: bold;
            color: var(--primary-green);
            font-size: 1.2rem;
        }

        .strategy-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
        }

        .strategy-section h4 {
            color: var(--dark-green);
            margin-bottom: 0.5rem;
        }

        .strategy-section ul {
            list-style: none;
            padding: 0;
        }

        .strategy-section li {
            padding: 0.5rem 0;
            padding-left: 1.5rem;
            position: relative;
        }

        .strategy-section li:before {
            content: "‚ñ∏";
            position: absolute;
            left: 0;
            color: var(--primary-green);
        }

        .arguments-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .argument-item {
            display: flex;
            gap: 1rem;
            padding: 1rem;
            background: var(--bg-light);
            border-radius: 8px;
            align-items: flex-start;
        }

        .argument-number {
            background: var(--primary-green);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }

        .steps-timeline {
            display: flex;
            justify-content: space-between;
            position: relative;
            padding: 2rem 0;
        }

        .steps-timeline:before {
            content: "";
            position: absolute;
            top: 35px;
            left: 0;
            right: 0;
            height: 2px;
            background: #ddd;
            z-index: 0;
        }

        .step-item {
            flex: 1;
            text-align: center;
            position: relative;
            z-index: 1;
        }

        .step-marker {
            width: 40px;
            height: 40px;
            background: white;
            border: 3px solid #ddd;
            border-radius: 50%;
            margin: 0 auto 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .step-item.active .step-marker {
            background: var(--primary-green);
            color: white;
            border-color: var(--primary-green);
        }

        .step-content {
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .profile-grid {
                grid-template-columns: 1fr;
            }
            
            .strategy-grid {
                grid-template-columns: 1fr;
            }
            
            .steps-timeline {
                flex-direction: column;
                gap: 1rem;
            }
            
            .steps-timeline:before {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="header-container">
            <div class="logo">FreshPlan Sales Tool</div>
            <nav class="nav-tabs">
                <div class="nav-tab active" data-tab="demonstrator" data-lang-key="nav.demo">Rabatt-Demo</div>
                <div class="nav-tab" data-tab="customer" data-lang-key="nav.customer">Kundendaten</div>
                <div class="nav-tab" data-tab="profile" data-lang-key="nav.profile">Kundenprofil</div>
                <div class="nav-tab" data-tab="offer" data-lang-key="nav.offer">Angebot</div>
                <div class="nav-tab" data-tab="settings" data-lang-key="nav.settings">Einstellungen</div>
                <div class="progress-bar" id="progressBar"></div>
            </nav>
            <div class="language-switcher">
                <button class="lang-btn active" data-lang="de">DE</button>
                <button class="lang-btn" data-lang="en">EN</button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-container">
        <!-- Success/Error Messages -->
        <div id="successMessage" class="message success"></div>
        <div id="errorMessage" class="message error"></div>

        <!-- Autosave Indicator -->
        <div id="autosaveIndicator" class="autosave-indicator">
            <span id="autosaveText">Automatisch gespeichert</span>
            <span>‚úì</span>
        </div>

        <!-- Rabatt Demonstrator Tab -->
        <div id="demonstrator" class="tab-content active">
            <div class="card">
                <h2 class="card-title" data-lang-key="demo.title">Interaktiver Rabatt-Demonstrator</h2>
                
                <div class="demonstrator-container">
                    <!-- Controls -->
                    <div class="demo-controls">
                        <h3 data-lang-key="demo.parameters">Bestellparameter</h3>
                        
                        <div class="slider-container">
                            <label data-lang-key="demo.orderValue">
                                Bestellwert (netto)
                                <span class="tooltip">
                                    <span class="help-icon">?</span>
                                    <span class="tooltiptext">Der Netto-Bestellwert bestimmt Ihre Grundrabattstufe. Je h√∂her der Wert, desto mehr sparen Sie!</span>
                                </span>
                            </label>
                            <input type="range" id="orderValue" class="slider" min="1000" max="100000" value="15000" step="1000">
                            <div class="value-display" id="orderValueDisplay">15.000 ‚Ç¨</div>
                            <div class="rabatt-stufe" id="rabattStufe">Rabattstufe: 6%</div>
                        </div>

                        <div class="slider-container">
                            <label data-lang-key="demo.leadTime">
                                Vorlaufzeit (Tage)
                                <span class="tooltip">
                                    <span class="help-icon">?</span>
                                    <span class="tooltiptext">Planen Sie voraus und sparen Sie zus√§tzlich! Ab 10 Tagen Vorlauf gibt es Extra-Rabatte.</span>
                                </span>
                            </label>
                            <input type="range" id="leadTime" class="slider" min="0" max="45" value="7" step="1">
                            <div class="value-display" id="leadTimeDisplay">7 Tage</div>
                            <div class="rabatt-stufe" id="fr√ºhbucherBonus">Fr√ºhbucherrabatt: 0%</div>
                        </div>

                        <div class="toggle-container">
                            <label data-lang-key="demo.pickup">
                                Selbstabholung
                                <span class="tooltip">
                                    <span class="help-icon">?</span>
                                    <span class="tooltiptext">Bei Selbstabholung ab 5.000‚Ç¨ Bestellwert erhalten Sie 2% zus√§tzlichen Rabatt!</span>
                                </span>
                            </label>
                            <label class="toggle-switch">
                                <input type="checkbox" id="pickupToggle">
                                <span class="toggle-slider"></span>
                            </label>
                            <span id="pickupBonus">+0%</span>
                        </div>

                        <div class="toggle-container">
                            <label data-lang-key="demo.chain">
                                Kettenkunde (Wochenb√ºndelung)
                                <span class="tooltip">
                                    <span class="help-icon">?</span>
                                    <span class="tooltiptext">Als Kettenkunde k√∂nnen Sie Bestellungen mehrerer Standorte b√ºndeln und gemeinsam h√∂here Rabattstufen erreichen.</span>
                                </span>
                            </label>
                            <label class="toggle-switch">
                                <input type="checkbox" id="chainToggle">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>

                    <!-- Results -->
                    <div class="demo-results">
                        <h3 data-lang-key="demo.yourSavings">Ihre Ersparnis</h3>
                        
                        <div class="savings-box">
                            <div data-lang-key="demo.totalDiscount">Gesamtrabatt:</div>
                            <div class="savings-amount" id="totalDiscount">6%</div>
                        </div>

                        <div class="savings-box">
                            <div data-lang-key="demo.savingsEuro">Ersparnis in Euro:</div>
                            <div class="savings-amount" id="totalSavings">900 ‚Ç¨</div>
                        </div>

                        <div class="savings-box">
                            <div data-lang-key="demo.toPay">Zu zahlen:</div>
                            <div class="savings-amount" id="finalPrice">14.100 ‚Ç¨</div>
                        </div>
                    </div>
                </div>

                <!-- Scenario Comparison -->
                <h3 style="margin-top: 3rem;" data-lang-key="demo.scenarioTitle">Szenario-Vergleich</h3>
                <div class="scenario-grid" id="scenarioGrid">
                    <!-- Dynamically generated scenarios -->
                </div>

                <!-- Kombi-Bestellung Info -->
                <div class="card" style="margin-top: 2rem; background: rgba(127, 176, 105, 0.1);">
                    <h3 data-lang-key="demo.combiTitle">Kombi-Bestellung (ab 30.000‚Ç¨)</h3>
                    <p data-lang-key="demo.combiText">Gro√übestellungen k√∂nnen flexibel auf 2 Liefertermine innerhalb von 4 Wochen aufgeteilt werden. Der Gesamtrabatt gilt f√ºr beide Lieferungen!</p>
                    <div class="info-box">
                        <h4 data-lang-key="demo.example">Beispiel:</h4>
                        <p>40.000‚Ç¨ Bestellung ‚Üí 25.000‚Ç¨ (KW 23) + 15.000‚Ç¨ (KW 26) = 8% Basisrabatt auf beide Lieferungen</p>
                    </div>
                </div>

                <!-- Price Stability Info -->
                <div class="card" style="margin-top: 2rem; background: linear-gradient(135deg, #f0f8ff, #e6f3ff);">
                    <h3 data-lang-key="demo.priceStability">12 Monate Preisstabilit√§t</h3>
                    <div style="display: flex; align-items: center; gap: 2rem;">
                        <div style="font-size: 3rem;">üõ°Ô∏è</div>
                        <div>
                            <p data-lang-key="demo.priceStabilityText">Ihre vereinbarten Preise bleiben w√§hrend der gesamten Vertragslaufzeit stabil. Schutz vor Inflation inklusive!</p>
                            <small data-lang-key="demo.priceStabilityDetail">Preisanpassung nur bei Indexsteigerung >5% (dann nur der Anteil dar√ºber)</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Customer Data Tab -->
        <div id="customer" class="tab-content">
            <div class="card">
                <h2 class="card-title" data-lang-key="customer.title">Kundendaten erfassen</h2>

                <!-- Customer Type Selection -->
                <div class="customer-type-selector">
                    <div class="type-option selected" data-type="single">
                        <h3 data-lang-key="customer.single">Einzelstandort</h3>
                        <p data-lang-key="customer.singleDesc">Ein Standort</p>
                    </div>
                    <div class="type-option" data-type="chain">
                        <h3 data-lang-key="customer.chain">Kette/Gruppe</h3>
                        <p data-lang-key="customer.chainDesc">Mehrere Standorte</p>
                    </div>
                </div>

                <!-- Basic Customer Form -->
                <form id="customerForm">
                    <h3 data-lang-key="customer.baseData">Stammdaten</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="required" data-lang-key="customer.companyName">Firmenname</label>
                            <input type="text" id="companyName" required data-autosave="true">
                            <div class="error-message" id="companyNameError"></div>
                        </div>
                        <div class="form-group">
                            <label data-lang-key="customer.legalForm">Rechtsform</label>
                            <select id="legalForm" data-autosave="true">
                                <option value="gmbh">GmbH</option>
                                <option value="ag">AG</option>
                                <option value="ggmbh">gGmbH</option>
                                <option value="ev">e.V.</option>
                                <option value="other" data-lang-key="customer.other">Sonstige</option>
                            </select>
                        </div>
                    </div>

                    <h3 data-lang-key="customer.contact">Ansprechpartner</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="required" data-lang-key="customer.contactName">Name</label>
                            <input type="text" id="contactName" required data-autosave="true">
                            <div class="error-message" id="contactNameError"></div>
                        </div>
                        <div class="form-group">
                            <label data-lang-key="customer.position">Position</label>
                            <input type="text" id="contactPosition" data-autosave="true">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="required" data-lang-key="customer.email">E-Mail</label>
                            <input type="email" id="contactEmail" required data-autosave="true">
                            <div class="error-message" id="contactEmailError"></div>
                        </div>
                        <div class="form-group">
                            <label class="required" data-lang-key="customer.phone">Telefon</label>
                            <input type="tel" id="contactPhone" required data-autosave="true">
                            <div class="error-message" id="contactPhoneError"></div>
                        </div>
                    </div>

                    <h3 data-lang-key="customer.address">Adresse</h3>
                    <div class="form-group">
                        <label class="required" data-lang-key="customer.street">Stra√üe und Hausnummer</label>
                        <input type="text" id="street" required data-autosave="true">
                        <div class="error-message" id="streetError"></div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label class="required" data-lang-key="customer.zip">PLZ</label>
                            <input type="text" id="zipCode" required data-autosave="true" pattern="[0-9]{5}" maxlength="5">
                            <div class="error-message" id="zipCodeError"></div>
                        </div>
                        <div class="form-group">
                            <label class="required" data-lang-key="customer.city">Ort</label>
                            <input type="text" id="city" required data-autosave="true">
                            <div class="error-message" id="cityError"></div>
                        </div>
                    </div>

                    <h3 data-lang-key="customer.industryTarget">Branche & Zielumsatz</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="required" data-lang-key="customer.industry">Branche</label>
                            <select id="industry" required data-autosave="true">
                                <option value="" data-lang-key="customer.pleaseSelect">Bitte w√§hlen</option>
                                <option value="hotel">Hotel</option>
                                <option value="altenheim" data-lang-key="customer.nursingHome">Alten-/Pflegeheim</option>
                                <option value="krankenhaus" data-lang-key="customer.hospital">Krankenhaus/Klinik</option>
                                <option value="betriebsrestaurant" data-lang-key="customer.canteen">Betriebsrestaurant</option>
                                <option value="restaurant">Restaurant/Caterer</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="required" data-lang-key="customer.targetRevenue">
                                Geplanter Jahresumsatz (‚Ç¨)
                                <span class="tooltip">
                                    <span class="help-icon">?</span>
                                    <span class="tooltiptext">Das Zielvolumen ist eine unverbindliche Absichtserkl√§rung f√ºr Ihre Jahresplanung. Es gibt keine Mindestabnahme!</span>
                                </span>
                            </label>
                            <input type="number" id="targetRevenue" required min="0" step="1000" data-autosave="true">
                            <div class="error-message" id="targetRevenueError"></div>
                        </div>
                    </div>

                    <!-- Branch Specific Fields (Dynamic) -->
                    <div id="branchSpecificFields"></div>

                    <!-- Chain Quick Entry (Hidden by default) -->
                    <div id="chainQuickEntry" class="chain-quick-entry" style="display: none;">
                        <h3 data-lang-key="customer.chainQuickEntry">Kettenverwaltung - Schnellerfassung</h3>
                        <div class="form-group">
                            <label data-lang-key="customer.totalLocations">Gesamtanzahl Standorte</label>
                            <input type="number" id="totalLocations" min="2" value="2" data-autosave="true">
                        </div>
                        
                        <div id="chainCategorization">
                            <!-- Dynamic content based on selected industry -->
                        </div>

                        <div class="chain-detail-toggle">
                            <button type="button" class="btn btn-secondary" onclick="toggleChainDetails()">
                                <span data-lang-key="customer.detailView">Detailansicht</span>
                            </button>
                        </div>

                        <div id="chainLocationsDetail" class="chain-locations-detail">
                            <!-- Dynamic location details -->
                        </div>
                    </div>

                    <!-- Vending Option -->
                    <div class="card" style="margin-top: 2rem;">
                        <h3 data-lang-key="customer.vendingConcept">Vending-Konzept</h3>
                        <div class="toggle-container">
                            <label data-lang-key="customer.vendingInterest">Interesse an Freshfoodz-Vending?</label>
                            <label class="toggle-switch">
                                <input type="checkbox" id="vendingInterest" data-autosave="true">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>

                        <div id="vendingDetails" style="display: none; margin-top: 1rem;">
                            <div class="form-row">
                                <div class="form-group">
                                    <label data-lang-key="customer.vendingLocations">Anzahl Automaten-Standorte</label>
                                    <input type="number" id="vendingLocations" min="1" value="1" data-autosave="true">
                                </div>
                                <div class="form-group">
                                    <label data-lang-key="customer.vendingDaily">Erwartete Entnahmen/Tag</label>
                                    <input type="number" id="vendingDaily" min="1" value="20" data-autosave="true">
                                </div>
                            </div>

                            <h4 data-lang-key="customer.vendingProducts">Produktsortiment im Automaten:</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem;">
                                <label><input type="checkbox" id="vendingMain" checked data-autosave="true"> <span data-lang-key="customer.mainDishes">Hauptgerichte (Cook&Fresh)</span></label>
                                <label><input type="checkbox" id="vendingSoup" data-autosave="true"> <span data-lang-key="customer.soups">Suppen & Eint√∂pfe</span></label>
                                <label><input type="checkbox" id="vendingVeg" checked data-autosave="true"> <span data-lang-key="customer.vegetarian">Vegetarische/Vegane Gerichte</span></label>
                                <label><input type="checkbox" id="vendingPasta" data-autosave="true"> <span data-lang-key="customer.pasta">Pasta-Gerichte</span></label>
                            </div>
                        </div>
                    </div>

                    <div style="margin-top: 2rem;">
                        <button type="submit" class="btn btn-primary" data-lang-key="customer.save">Kundendaten speichern</button>
                        <button type="button" class="btn btn-secondary" onclick="calculatePotential()" data-lang-key="customer.calculator">Umsatz-Kalkulator</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Customer Profile Tab -->
        <div id="profile" class="tab-content">
            <div class="card">
                <h2 class="card-title" data-lang-key="profile.title">Kundenprofil & Verkaufsanalyse</h2>

                <!-- Profile Overview -->
                <div id="profileOverview" style="display: none;">
                    <div class="profile-grid" style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem;">
                        <!-- Customer Info Card -->
                        <div class="profile-card">
                            <h3 data-lang-key="profile.customerInfo">Kundeninformationen</h3>
                            <div id="profileBasicInfo"></div>
                        </div>

                        <!-- Potential Analysis -->
                        <div class="profile-card">
                            <h3 data-lang-key="profile.potential">Potenzialanalyse</h3>
                            <div id="profilePotential"></div>
                        </div>
                    </div>

                    <!-- Sales Strategy -->
                    <div class="card" style="margin-top: 2rem;">
                        <h3 data-lang-key="profile.salesStrategy">Verkaufsstrategie</h3>
                        <div id="profileStrategy"></div>
                    </div>

                    <!-- Key Arguments -->
                    <div class="card" style="margin-top: 2rem;">
                        <h3 data-lang-key="profile.keyArguments">Schl√ºsselargumente</h3>
                        <div id="profileArguments"></div>
                    </div>

                    <!-- Next Steps -->
                    <div class="card" style="margin-top: 2rem;">
                        <h3 data-lang-key="profile.nextSteps">N√§chste Schritte</h3>
                        <div id="profileNextSteps"></div>
                    </div>
                </div>

                <!-- Empty State -->
                <div id="profileEmpty" class="info-box">
                    <h4 data-lang-key="profile.noData">Keine Kundendaten vorhanden</h4>
                    <p data-lang-key="profile.noDataText">Bitte erfassen Sie zuerst die Kundendaten, um das Profil zu generieren.</p>
                    <button class="btn btn-primary" onclick="switchTab('customer')" data-lang-key="profile.goToCustomer">Zu Kundendaten</button>
                </div>
            </div>
        </div>

        <!-- Offer Tab -->
        <div id="offer" class="tab-content">
            <div class="card">
                <h2 class="card-title" data-lang-key="offer.title">Angebot erstellen</h2>

                <!-- Salesperson Section -->
                <div class="salesperson-section">
                    <h3 data-lang-key="offer.salesperson">Verk√§ufer-Informationen</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="required" data-lang-key="offer.salespersonName">Name</label>
                            <input type="text" id="salespersonName">
                            <div class="error-message" id="salespersonNameError"></div>
                        </div>
                        <div class="form-group">
                            <label class="required" data-lang-key="offer.salespersonEmail">E-Mail</label>
                            <input type="email" id="salespersonEmail">
                            <div class="error-message" id="salespersonEmailError"></div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label data-lang-key="offer.salespersonPhone">Telefon</label>
                            <input type="tel" id="salespersonPhone">
                        </div>
                        <div class="form-group">
                            <label data-lang-key="offer.salespersonMobile">Mobil</label>
                            <input type="tel" id="salespersonMobile">
                        </div>
                    </div>
                </div>

                <!-- Price Catalog Selection -->
                <div class="form-group">
                    <label class="required" data-lang-key="offer.priceCatalog">Preiskatalog ausw√§hlen</label>
                    <select id="priceCatalog">
                        <option value="standard" data-lang-key="offer.standardPrice">Standard-Preisliste 2025</option>
                        <option value="grosskunden" data-lang-key="offer.volumePrice">Gro√ükunden-Preisliste 2025</option>
                        <option value="export" data-lang-key="offer.exportPrice">Export-Preisliste 2025</option>
                    </select>
                </div>

                <!-- Contract Details -->
                <div class="form-row">
                    <div class="form-group">
                        <label class="required" data-lang-key="offer.contractStart">Vertragsbeginn</label>
                        <input type="date" id="contractStart">
                    </div>
                    <div class="form-group">
                        <label data-lang-key="offer.contractEnd">Vertragsende (automatisch)</label>
                        <input type="date" id="contractEnd" readonly>
                    </div>
                </div>

                <!-- Legal Notice -->
                <div class="info-box" style="background: rgba(255, 193, 7, 0.1); border-left-color: #FFC107;">
                    <h4>Wichtiger Hinweis</h4>
                    <p>Das Zielvolumen stellt eine Einkaufsabsichtserkl√§rung dar, jedoch keine rechtlich verbindliche Abnahmeverpflichtung. Die Rabatte gelten nur in Verbindung mit einer aktiven FreshPlan-Vereinbarung.</p>
                </div>

                <!-- Price Stability Info -->
                <div class="info-box" style="margin-top: 1rem;">
                    <h4>Preisstabilit√§t w√§hrend der Vertragslaufzeit</h4>
                    <p>Die vereinbarten Preise bleiben f√ºr 12 Monate stabil. Eine Anpassung erfolgt nur bei einer Indexsteigerung >5% (dann nur der Anteil dar√ºber). Dies bietet Ihnen Planungssicherheit und Inflationsschutz!</p>
                </div>

                <!-- Additional Notes -->
                <div class="form-group">
                    <label data-lang-key="offer.notes">Zus√§tzliche Notizen</label>
                    <textarea id="additionalNotes" rows="4"></textarea>
                </div>

                <!-- Document Selection -->
                <h3 data-lang-key="offer.documents">Dokumente ausw√§hlen</h3>
                <div style="display: grid; gap: 0.5rem;">
                    <label><input type="checkbox" id="docCoverLetter" checked> <span data-lang-key="offer.coverLetter">Anschreiben</span></label>
                    <label><input type="checkbox" id="docPartnership" checked> <span data-lang-key="offer.partnership">FreshPlan-Partnerschaftsvereinbarung</span></label>
                    <label><input type="checkbox" id="docRabatt" checked> <span data-lang-key="offer.discountSystem">Anlage 1: Rabattsystem</span></label>
                    <label><input type="checkbox" id="docAGB" checked> <span data-lang-key="offer.terms">Anlage 2: AGB</span></label>
                    <label><input type="checkbox" id="docCalc" checked> <span data-lang-key="offer.calculations">Kalkulationsbeispiele</span></label>
                </div>

                <!-- Document Upload Section -->
                <div class="card" style="margin-top: 2rem; background: var(--bg-light);">
                    <h3 data-lang-key="offer.documentUpload">Dokumenten-Verwaltung</h3>
                    <div class="info-box">
                        <h4 data-lang-key="offer.uploadInfo">Hinweis</h4>
                        <p data-lang-key="offer.uploadInfoText">Sie k√∂nnen hier aktuelle Versionen der Vertragsunterlagen hochladen. Die hochgeladenen Dokumente werden anstelle der Standard-Vorlagen verwendet.</p>
                    </div>

                    <div class="document-upload-grid" style="display: grid; gap: 1rem; margin-top: 1rem;">
                        <div class="upload-item" style="display: flex; align-items: center; gap: 1rem;">
                            <label style="flex: 1;">Partnerschaftsvereinbarung:</label>
                            <input type="file" id="uploadPartnership" accept=".pdf,.docx" onchange="handleDocumentUpload('partnership', this)">
                            <span id="partnershipStatus" style="color: var(--success); display: none;">‚úì Hochgeladen</span>
                        </div>
                        <div class="upload-item" style="display: flex; align-items: center; gap: 1rem;">
                            <label style="flex: 1;">Rabattsystem (Anlage 1):</label>
                            <input type="file" id="uploadRabatt" accept=".pdf,.docx" onchange="handleDocumentUpload('rabatt', this)">
                            <span id="rabattStatus" style="color: var(--success); display: none;">‚úì Hochgeladen</span>
                        </div>
                        <div class="upload-item" style="display: flex; align-items: center; gap: 1rem;">
                            <label style="flex: 1;">AGB (Anlage 2):</label>
                            <input type="file" id="uploadAGB" accept=".pdf,.docx" onchange="handleDocumentUpload('agb', this)">
                            <span id="agbStatus" style="color: var(--success); display: none;">‚úì Hochgeladen</span>
                        </div>
                    </div>

                    <button class="btn btn-secondary" style="margin-top: 1rem;" onclick="resetDocuments()">
                        <span data-lang-key="offer.resetDocuments">Standard-Dokumente verwenden</span>
                    </button>
                </div>

                <!-- Action Buttons -->
                <div style="margin-top: 2rem; display: flex; gap: 1rem; flex-wrap: wrap;">
                    <button class="btn btn-primary" onclick="generateOffer()" data-lang-key="offer.generate">
                        PDF generieren & Vorschau
                    </button>
                    <button class="btn btn-secondary" onclick="sendOffer()" data-lang-key="offer.send">
                        Per E-Mail versenden
                    </button>
                    <button class="btn btn-secondary" onclick="printOffer()" data-lang-key="offer.print">
                        Drucken
                    </button>
                </div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="settings" class="tab-content">
            <div class="card">
                <h2 class="card-title" data-lang-key="settings.title">Einstellungen</h2>

                <!-- Default Salesperson Info -->
                <h3 data-lang-key="settings.defaultSalesperson">Standard Verk√§ufer-Informationen</h3>
                <div class="info-box">
                    <h4 data-lang-key="settings.tip">Tipp</h4>
                    <p data-lang-key="settings.tipText">Speichern Sie hier Ihre Standard-Verk√§uferdaten, damit diese automatisch in neuen Angeboten vorausgef√ºllt werden.</p>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label data-lang-key="settings.defaultName">Standard Name</label>
                        <input type="text" id="defaultSalespersonName">
                    </div>
                    <div class="form-group">
                        <label data-lang-key="settings.defaultEmail">Standard E-Mail</label>
                        <input type="email" id="defaultSalespersonEmail">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label data-lang-key="settings.defaultPhone">Standard Telefon</label>
                        <input type="tel" id="defaultSalespersonPhone">
                    </div>
                    <div class="form-group">
                        <label data-lang-key="settings.defaultMobile">Standard Mobil</label>
                        <input type="tel" id="defaultSalespersonMobile">
                    </div>
                </div>

                <!-- Monday.com Integration -->
                <h3 data-lang-key="settings.mondayIntegration">Monday.com Integration</h3>
                <div class="form-group">
                    <label>API Token</label>
                    <input type="password" id="mondayToken" placeholder="Ihr Monday.com API Token">
                </div>
                <div class="form-group">
                    <label>Board ID</label>
                    <input type="text" id="mondayBoardId" placeholder="Board ID f√ºr CRM">
                </div>
                <button class="btn btn-secondary" onclick="testMondayConnection()" data-lang-key="settings.testConnection">Verbindung testen</button>

                <!-- Email Settings -->
                <h3 data-lang-key="settings.emailSettings">E-Mail Einstellungen (All-Inkl)</h3>
                <div class="form-group">
                    <label>SMTP Server</label>
                    <input type="text" id="smtpServer" placeholder="w00xxxxx.kasserver.com">
                </div>
                <div class="form-group">
                    <label data-lang-key="settings.emailAddress">E-Mail Adresse</label>
                    <input type="email" id="smtpEmail" placeholder="freshplan@freshfoodz.de">
                </div>
                <div class="form-group">
                    <label data-lang-key="settings.password">Passwort</label>
                    <input type="password" id="smtpPassword">
                </div>

                <!-- Xentral Integration -->
                <h3 data-lang-key="settings.xentralIntegration">Xentral Integration</h3>
                <div class="form-group">
                    <label>API URL</label>
                    <input type="text" id="xentralUrl" placeholder="https://ihre-domain.xentral.com/api">
                </div>
                <div class="form-group">
                    <label>API Key</label>
                    <input type="password" id="xentralKey">
                </div>
                <button class="btn btn-secondary" onclick="syncPriceLists()" data-lang-key="settings.syncPrices">Preislisten synchronisieren</button>

                <div style="margin-top: 2rem;">
                    <button class="btn btn-primary" onclick="saveSettings()" data-lang-key="settings.save">Einstellungen speichern</button>
                </div>
            </div>
        </div>
    </main>

    <!-- PDF Preview Modal -->
    <div id="pdfModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 data-lang-key="pdf.preview">PDF Vorschau</h2>
                <span class="close" onclick="closePdfModal()">&times;</span>
            </div>
            <div id="pdfPreview">
                <iframe id="pdfFrame" class="pdf-preview-frame"></iframe>
            </div>
            <div style="margin-top: 1rem; display: flex; gap: 1rem;">
                <button class="btn btn-primary" onclick="downloadPdf()" data-lang-key="pdf.download">PDF herunterladen</button>
                <button class="btn btn-secondary" onclick="closePdfModal()" data-lang-key="pdf.close">Schlie√üen</button>
            </div>
        </div>
    </div>

    <!-- Calculation Modal -->
    <div id="calcModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 data-lang-key="calc.title">Umsatzpotenzial-Berechnung</h2>
                <span class="close" onclick="closeCalcModal()">&times;</span>
            </div>
            <div id="calcContent" class="calc-result">
                <!-- Calculation results will be displayed here -->
            </div>
            <div style="margin-top: 1rem;">
                <button class="btn btn-primary" onclick="applyCalculation()" data-lang-key="calc.apply">√úbernehmen</button>
                <button class="btn btn-secondary" onclick="closeCalcModal()" data-lang-key="calc.close">Schlie√üen</button>
            </div>
        </div>
    </div>

    <script>
        // Error Handler
        window.addEventListener('error', function(e) {
            console.warn('Fehler aufgefangen:', e.message);
            return true; // Verhindert Standard-Fehlerbehandlung
        });

        // In-Memory Storage for Claude.ai Environment
        const memoryStorage = {
            data: {},
            getItem: function(key) {
                return this.data[key] || null;
            },
            setItem: function(key, value) {
                this.data[key] = value;
                return true;
            },
            removeItem: function(key) {
                delete this.data[key];
            }
        };

        // Use memoryStorage instead of localStorage
        const storage = memoryStorage;

        // Debounce utility
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Global Variables
        let currentLang = 'de';
        let customerData = {};
        let discountCalculation = {};
        let chainLocations = [];
        let calculatedRevenue = 0;
        let generatedPdf = null;
        let autosaveTimer = null;
        let tabProgress = {
            demonstrator: false,
            customer: false,
            profile: false,
            offer: false
        };
        let uploadedDocuments = {
            partnership: null,
            rabatt: null,
            agb: null
        };

        // Complete Translations
        const translations = {
            de: {
                nav: {
                    demo: 'Rabatt-Demo',
                    customer: 'Kundendaten',
                    profile: 'Kundenprofil',
                    offer: 'Angebot',
                    settings: 'Einstellungen'
                },
                demo: {
                    title: 'Interaktiver Rabatt-Demonstrator',
                    parameters: 'Bestellparameter',
                    orderValue: 'Bestellwert (netto)',
                    leadTime: 'Vorlaufzeit (Tage)',
                    pickup: 'Selbstabholung',
                    chain: 'Kettenkunde (Wochenb√ºndelung)',
                    yourSavings: 'Ihre Ersparnis',
                    totalDiscount: 'Gesamtrabatt:',
                    savingsEuro: 'Ersparnis in Euro:',
                    toPay: 'Zu zahlen:',
                    scenarioTitle: 'Szenario-Vergleich',
                    spontaneous: 'Spontanbestellung',
                    planned: 'Geplante Bestellung',
                    optimal: 'Optimale Planung',
                    days: 'Tage',
                    delivery: 'Lieferung',
                    savings: 'Ersparnis',
                    baseDiscount: 'Rabattstufe',
                    earlyBooking: 'Fr√ºhbucherrabatt',
                    combiTitle: 'Kombi-Bestellung (ab 30.000‚Ç¨)',
                    combiText: 'Gro√übestellungen k√∂nnen flexibel auf 2 Liefertermine innerhalb von 4 Wochen aufgeteilt werden. Der Gesamtrabatt gilt f√ºr beide Lieferungen!',
                    example: 'Beispiel',
                    priceStability: '12 Monate Preisstabilit√§t',
                    priceStabilityText: 'Ihre vereinbarten Preise bleiben w√§hrend der gesamten Vertragslaufzeit stabil. Schutz vor Inflation inklusive!',
                    priceStabilityDetail: 'Preisanpassung nur bei Indexsteigerung >5% (dann nur der Anteil dar√ºber)',
                    kombi: 'Kombi-Bestellung',
                    kombiSpecial: '2 Lieferungen',
                    chainBundle: 'Kettenb√ºndelung',
                    chainSpecial: 'Wochenb√ºndelung'
                },
                customer: {
                    title: 'Kundendaten erfassen',
                    single: 'Einzelstandort',
                    singleDesc: 'Ein Standort',
                    chain: 'Kette/Gruppe',
                    chainDesc: 'Mehrere Standorte',
                    baseData: 'Stammdaten',
                    companyName: 'Firmenname',
                    legalForm: 'Rechtsform',
                    other: 'Sonstige',
                    contact: 'Ansprechpartner',
                    contactName: 'Name',
                    position: 'Position',
                    email: 'E-Mail',
                    phone: 'Telefon',
                    address: 'Adresse',
                    street: 'Stra√üe und Hausnummer',
                    zip: 'PLZ',
                    city: 'Ort',
                    industryTarget: 'Branche & Zielumsatz',
                    industry: 'Branche',
                    pleaseSelect: 'Bitte w√§hlen',
                    nursingHome: 'Alten-/Pflegeheim',
                    hospital: 'Krankenhaus/Klinik',
                    canteen: 'Betriebsrestaurant',
                    targetRevenue: 'Geplanter Jahresumsatz (‚Ç¨)',
                    chainQuickEntry: 'Kettenverwaltung - Schnellerfassung',
                    totalLocations: 'Gesamtanzahl Standorte',
                    detailView: 'Detailansicht',
                    vendingConcept: 'Vending-Konzept',
                    vendingInterest: 'Interesse an Freshfoodz-Vending?',
                    vendingLocations: 'Anzahl Automaten-Standorte',
                    vendingDaily: 'Erwartete Entnahmen/Tag',
                    vendingProducts: 'Produktsortiment im Automaten:',
                    mainDishes: 'Hauptgerichte (Cook&Fresh)',
                    soups: 'Suppen & Eint√∂pfe',
                    vegetarian: 'Vegetarische/Vegane Gerichte',
                    pasta: 'Pasta-Gerichte',
                    save: 'Kundendaten speichern',
                    calculator: 'Umsatz-Kalkulator',
                    hotelSpecific: 'Hotel-spezifische Angaben',
                    rooms: 'Anzahl Zimmer',
                    restaurantSeats: 'Restaurant-Pl√§tze',
                    occupancy: 'Durchschn. Auslastung (%)',
                    breakfastGuests: 'Fr√ºhst√ºcksg√§ste/Tag',
                    nursingSpecific: 'Pflegeheim-spezifische Angaben',
                    residents: 'Anzahl Bewohner',
                    mealsPerDay: 'Mahlzeiten/Tag',
                    specialDiets: 'Di√§tformen-Anteil (%)',
                    consistency: 'Konsistenzstufen',
                    hospitalSpecific: 'Klinik-spezifische Angaben',
                    beds: 'Anzahl Betten',
                    bedOccupancy: 'Durchschn. Auslastung (%)',
                    privateRatio: 'Anteil Privatpatienten (%)',
                    premiumMeals: 'Wahlleistung Essen',
                    staffCatering: 'Mitarbeiterverpflegung',
                    publicCafeteria: '√ñffentliche Cafeteria',
                    canteenSpecific: 'Betriebsrestaurant-spezifische Angaben',
                    employees: 'Anzahl Mitarbeiter',
                    dailyDiners: 'Essensteilnehmer/Tag',
                    operatingDays: 'Betriebstage/Jahr',
                    subsidized: 'Subventionierung',
                    restaurantSpecific: 'Restaurant-spezifische Angaben',
                    seats: 'Sitzpl√§tze',
                    dailyGuests: 'Durchschn. G√§ste/Tag',
                    eventCatering: 'Event-Catering',
                    branches: 'Anzahl Filialen'
                },
                profile: {
                    title: 'Kundenprofil & Verkaufsanalyse',
                    customerInfo: 'Kundeninformationen',
                    potential: 'Potenzialanalyse',
                    salesStrategy: 'Verkaufsstrategie',
                    keyArguments: 'Schl√ºsselargumente',
                    nextSteps: 'N√§chste Schritte',
                    noData: 'Keine Kundendaten vorhanden',
                    noDataText: 'Bitte erfassen Sie zuerst die Kundendaten, um das Profil zu generieren.',
                    goToCustomer: 'Zu Kundendaten',
                    currentSituation: 'Aktuelle Situation',
                    targetVolume: 'Zielvolumen',
                    savingsPotential: 'Einsparpotenzial',
                    contractValue: 'Vertragswert',
                    industrySpecific: 'Branchenspezifisch',
                    decisionCriteria: 'Entscheidungskriterien',
                    painPoints: 'Pain Points',
                    opportunities: 'Chancen',
                    competitiveAdvantage: 'Wettbewerbsvorteile'
                },
                offer: {
                    title: 'Angebot erstellen',
                    priceCatalog: 'Preiskatalog ausw√§hlen',
                    standardPrice: 'Standard-Preisliste 2025',
                    volumePrice: 'Gro√ükunden-Preisliste 2025',
                    exportPrice: 'Export-Preisliste 2025',
                    contractStart: 'Vertragsbeginn',
                    contractEnd: 'Vertragsende (automatisch)',
                    salesperson: 'Verk√§ufer-Informationen',
                    salespersonName: 'Name',
                    salespersonEmail: 'E-Mail',
                    salespersonPhone: 'Telefon',
                    salespersonMobile: 'Mobil',
                    notes: 'Zus√§tzliche Notizen',
                    documents: 'Dokumente ausw√§hlen',
                    coverLetter: 'Anschreiben',
                    partnership: 'FreshPlan-Partnerschaftsvereinbarung',
                    discountSystem: 'Anlage 1: Rabattsystem',
                    terms: 'Anlage 2: AGB',
                    calculations: 'Kalkulationsbeispiele',
                    generate: 'PDF generieren & Vorschau',
                    send: 'Per E-Mail versenden',
                    print: 'Drucken',
                    documentUpload: 'Dokumenten-Verwaltung',
                    uploadInfo: 'Hinweis',
                    uploadInfoText: 'Sie k√∂nnen hier aktuelle Versionen der Vertragsunterlagen hochladen. Die hochgeladenen Dokumente werden anstelle der Standard-Vorlagen verwendet.',
                    resetDocuments: 'Standard-Dokumente verwenden'
                },
                settings: {
                    title: 'Einstellungen',
                    defaultSalesperson: 'Standard Verk√§ufer-Informationen',
                    tip: 'Tipp',
                    tipText: 'Speichern Sie hier Ihre Standard-Verk√§uferdaten, damit diese automatisch in neuen Angeboten vorausgef√ºllt werden.',
                    defaultName: 'Standard Name',
                    defaultEmail: 'Standard E-Mail',
                    defaultPhone: 'Standard Telefon',
                    defaultMobile: 'Standard Mobil',
                    mondayIntegration: 'Monday.com Integration',
                    testConnection: 'Verbindung testen',
                    emailSettings: 'E-Mail Einstellungen (All-Inkl)',
                    emailAddress: 'E-Mail Adresse',
                    password: 'Passwort',
                    xentralIntegration: 'Xentral Integration',
                    syncPrices: 'Preislisten synchronisieren',
                    save: 'Einstellungen speichern'
                },
                messages: {
                    customerSaved: 'Kundendaten wurden gespeichert!',
                    fillCustomerFirst: 'Bitte erst Kundendaten erfassen!',
                    fillSalespersonInfo: 'Bitte Verk√§ufer-Informationen eingeben!',
                    pdfGenerating: 'PDF wird generiert...',
                    emailSending: 'E-Mail wird versendet...',
                    settingsSaved: 'Einstellungen gespeichert!',
                    connectionSuccess: 'Verbindung erfolgreich!',
                    connectionError: 'Verbindungsfehler:',
                    syncSuccess: 'Preislisten synchronisiert!',
                    offerCreated: 'Angebot wurde erfolgreich erstellt!',
                    noEmailAddress: 'Keine E-Mail-Adresse vorhanden!',
                    emailOpened: 'E-Mail-Programm wurde ge√∂ffnet. Bitte f√ºgen Sie das PDF manuell hinzu.',
                    enterBranchData: 'Bitte geben Sie die branchenspezifischen Daten ein.',
                    missingAPIToken: 'Bitte API Token eingeben!',
                    missingXentralData: 'Bitte Xentral-Zugangsdaten eingeben!',
                    syncInProgress: 'Preislisten werden synchronisiert...',
                    invalidEmail: 'Bitte geben Sie eine g√ºltige E-Mail-Adresse ein.',
                    invalidPhone: 'Bitte geben Sie eine g√ºltige Telefonnummer ein.',
                    invalidZip: 'Bitte geben Sie eine 5-stellige Postleitzahl ein.',
                    requiredField: 'Dieses Feld ist erforderlich.'
                },
                calc: {
                    title: 'Umsatzpotenzial-Berechnung',
                    apply: '√úbernehmen',
                    close: 'Schlie√üen',
                    hotelCalc: 'Umsatzpotenzial Hotel',
                    nursingCalc: 'Umsatzpotenzial Pflegeheim',
                    hospitalCalc: 'Umsatzpotenzial Klinik',
                    canteenCalc: 'Umsatzpotenzial Betriebsrestaurant',
                    restaurantCalc: 'Umsatzpotenzial Restaurant',
                    roomService: 'Room Service',
                    breakfast: 'Fr√ºhst√ºck',
                    restaurant: 'Restaurant',
                    standard: 'Standard',
                    private: 'Privat',
                    staff: 'Mitarbeiter',
                    regular: 'Regul√§rer Betrieb',
                    events: 'Event-Catering',
                    vending: 'Vending',
                    totalPotential: 'Gesamtpotenzial',
                    realisticTarget: 'Realistisches Ziel',
                    utilization: 'Nutzungsquote',
                    ofEmployees: 'der Mitarbeiter'
                },
                pdf: {
                    preview: 'PDF Vorschau',
                    download: 'PDF herunterladen',
                    close: 'Schlie√üen',
                    contains: 'Das PDF enth√§lt:',
                    customer: 'Kunde:',
                    targetVolume: 'Zielvolumen:',
                    contractStart: 'Vertragsbeginn:'
                },
                chain: {
                    sizeCategories: 'Gr√∂√üenkategorien',
                    servicesEquipment: 'Ausstattung & Services',
                    smallHotel: 'Klein (bis 50 Zimmer)',
                    mediumHotel: 'Mittel (51-150 Zimmer)',
                    largeHotel: 'Gro√ü (√ºber 150 Zimmer)',
                    hotels: 'Hotels',
                    breakfastService: 'Fr√ºhst√ºcksservice',
                    restaurantAlaCarte: 'Restaurant √† la carte',
                    roomService: 'Room Service',
                    banquetEvents: 'Bankett/Veranstaltungen',
                    smallNursing: 'Klein (bis 50 Bewohner)',
                    mediumNursing: 'Mittel (51-100 Bewohner)',
                    largeNursing: 'Gro√ü (√ºber 100 Bewohner)',
                    homes: 'Heime',
                    fullMeals: 'Vollverpflegung (3 Mahlzeiten)',
                    snacks: 'Zwischenmahlzeiten',
                    smallHospital: 'Klein (bis 150 Betten)',
                    mediumHospital: 'Mittel (151-400 Betten)',
                    largeHospital: 'Gro√ü (√ºber 400 Betten)',
                    clinics: 'Kliniken',
                    patientStructure: 'Patientenstruktur',
                    privatePatientShare: 'Anteil Privatpatienten',
                    premiumMealOption: 'Wahlleistung Essen m√∂glich',
                    staffCateringAvailable: 'Mitarbeiterverpflegung',
                    smallCanteen: 'Klein (bis 200 MA)',
                    mediumCanteen: 'Mittel (201-500 MA)',
                    largeCanteen: 'Gro√ü (√ºber 500 MA)',
                    locations: 'Standorte',
                    serviceScope: 'Serviceumfang',
                    breakfast: 'Fr√ºhst√ºck',
                    lunch: 'Mittagessen',
                    dinner: 'Abendessen',
                    of: 'von'
                },
                yes: 'Ja',
                no: 'Nein',
                autosave: {
                    saving: 'Speichert...',
                    saved: 'Automatisch gespeichert'
                }
            },
            en: {
                nav: {
                    demo: 'Discount Demo',
                    customer: 'Customer Data',
                    profile: 'Customer Profile',
                    offer: 'Offer',
                    settings: 'Settings'
                },
                demo: {
                    title: 'Interactive Discount Demonstrator',
                    parameters: 'Order Parameters',
                    orderValue: 'Order Value (net)',
                    leadTime: 'Lead Time (Days)',
                    pickup: 'Self Pickup',
                    chain: 'Chain Customer (Week Bundling)',
                    yourSavings: 'Your Savings',
                    totalDiscount: 'Total Discount:',
                    savingsEuro: 'Savings in Euro:',
                    toPay: 'To Pay:',
                    scenarioTitle: 'Scenario Comparison',
                    spontaneous: 'Spontaneous Order',
                    planned: 'Planned Order',
                    optimal: 'Optimal Planning',
                    days: 'Days',
                    delivery: 'Delivery',
                    savings: 'Savings',
                    baseDiscount: 'Discount Level',
                    earlyBooking: 'Early Booking Discount',
                    combiTitle: 'Combined Order (from 30,000‚Ç¨)',
                    combiText: 'Large orders can be flexibly split into 2 delivery dates within 4 weeks. The total discount applies to both deliveries!',
                    example: 'Example',
                    priceStability: '12 Months Price Stability',
                    priceStabilityText: 'Your agreed prices remain stable throughout the entire contract period. Inflation protection included!',
                    priceStabilityDetail: 'Price adjustment only for index increase >5% (then only the portion above)',
                    kombi: 'Combined Order',
                    kombiSpecial: '2 Deliveries',
                    chainBundle: 'Chain Bundling',
                    chainSpecial: 'Week Bundling'
                },
                customer: {
                    title: 'Enter Customer Data',
                    single: 'Single Location',
                    singleDesc: 'One Location',
                    chain: 'Chain/Group',
                    chainDesc: 'Multiple Locations',
                    baseData: 'Master Data',
                    companyName: 'Company Name',
                    legalForm: 'Legal Form',
                    other: 'Other',
                    contact: 'Contact Person',
                    contactName: 'Name',
                    position: 'Position',
                    email: 'Email',
                    phone: 'Phone',
                    address: 'Address',
                    street: 'Street and Number',
                    zip: 'ZIP Code',
                    city: 'City',
                    industryTarget: 'Industry & Target Revenue',
                    industry: 'Industry',
                    pleaseSelect: 'Please Select',
                    nursingHome: 'Nursing Home',
                    hospital: 'Hospital/Clinic',
                    canteen: 'Company Restaurant',
                    targetRevenue: 'Planned Annual Revenue (‚Ç¨)',
                    chainQuickEntry: 'Chain Management - Quick Entry',
                    totalLocations: 'Total Number of Locations',
                    detailView: 'Detail View',
                    vendingConcept: 'Vending Concept',
                    vendingInterest: 'Interest in Freshfoodz Vending?',
                    vendingLocations: 'Number of Vending Locations',
                    vendingDaily: 'Expected Daily Sales',
                    vendingProducts: 'Product Range in Vending:',
                    mainDishes: 'Main Dishes (Cook&Fresh)',
                    soups: 'Soups & Stews',
                    vegetarian: 'Vegetarian/Vegan Dishes',
                    pasta: 'Pasta Dishes',
                    save: 'Save Customer Data',
                    calculator: 'Revenue Calculator',
                    hotelSpecific: 'Hotel-specific Information',
                    rooms: 'Number of Rooms',
                    restaurantSeats: 'Restaurant Seats',
                    occupancy: 'Average Occupancy (%)',
                    breakfastGuests: 'Breakfast Guests/Day',
                    nursingSpecific: 'Nursing Home-specific Information',
                    residents: 'Number of Residents',
                    mealsPerDay: 'Meals/Day',
                    specialDiets: 'Special Diets Share (%)',
                    consistency: 'Consistency Levels',
                    hospitalSpecific: 'Hospital-specific Information',
                    beds: 'Number of Beds',
                    bedOccupancy: 'Average Occupancy (%)',
                    privateRatio: 'Private Patients Share (%)',
                    premiumMeals: 'Premium Meal Option',
                    staffCatering: 'Staff Catering',
                    publicCafeteria: 'Public Cafeteria',
                    canteenSpecific: 'Company Restaurant-specific Information',
                    employees: 'Number of Employees',
                    dailyDiners: 'Daily Diners',
                    operatingDays: 'Operating Days/Year',
                    subsidized: 'Subsidized',
                    restaurantSpecific: 'Restaurant-specific Information',
                    seats: 'Seats',
                    dailyGuests: 'Average Guests/Day',
                    eventCatering: 'Event Catering',
                    branches: 'Number of Branches'
                },
                profile: {
                    title: 'Customer Profile & Sales Analysis',
                    customerInfo: 'Customer Information',
                    potential: 'Potential Analysis',
                    salesStrategy: 'Sales Strategy',
                    keyArguments: 'Key Arguments',
                    nextSteps: 'Next Steps',
                    noData: 'No Customer Data Available',
                    noDataText: 'Please enter customer data first to generate the profile.',
                    goToCustomer: 'Go to Customer Data',
                    currentSituation: 'Current Situation',
                    targetVolume: 'Target Volume',
                    savingsPotential: 'Savings Potential',
                    contractValue: 'Contract Value',
                    industrySpecific: 'Industry Specific',
                    decisionCriteria: 'Decision Criteria',
                    painPoints: 'Pain Points',
                    opportunities: 'Opportunities',
                    competitiveAdvantage: 'Competitive Advantages'
                },
                offer: {
                    title: 'Create Offer',
                    priceCatalog: 'Select Price Catalog',
                    standardPrice: 'Standard Price List 2025',
                    volumePrice: 'Volume Customer Price List 2025',
                    exportPrice: 'Export Price List 2025',
                    contractStart: 'Contract Start',
                    contractEnd: 'Contract End (automatic)',
                    salesperson: 'Salesperson Information',
                    salespersonName: 'Name',
                    salespersonEmail: 'Email',
                    salespersonPhone: 'Phone',
                    salespersonMobile: 'Mobile',
                    notes: 'Additional Notes',
                    documents: 'Select Documents',
                    coverLetter: 'Cover Letter',
                    partnership: 'FreshPlan Partnership Agreement',
                    discountSystem: 'Appendix 1: Discount System',
                    terms: 'Appendix 2: Terms & Conditions',
                    calculations: 'Calculation Examples',
                    generate: 'Generate PDF & Preview',
                    send: 'Send by Email',
                    print: 'Print',
                    documentUpload: 'Document Management',
                    uploadInfo: 'Note',
                    uploadInfoText: 'You can upload current versions of contract documents here. Uploaded documents will be used instead of standard templates.',
                    resetDocuments: 'Use Standard Documents'
                },
                settings: {
                    title: 'Settings',
                    defaultSalesperson: 'Default Salesperson Information',
                    tip: 'Tip',
                    tipText: 'Save your default salesperson data here to have it automatically pre-filled in new offers.',
                    defaultName: 'Default Name',
                    defaultEmail: 'Default Email',
                    defaultPhone: 'Default Phone',
                    defaultMobile: 'Default Mobile',
                    mondayIntegration: 'Monday.com Integration',
                    testConnection: 'Test Connection',
                    emailSettings: 'Email Settings (All-Inkl)',
                    emailAddress: 'Email Address',
                    password: 'Password',
                    xentralIntegration: 'Xentral Integration',
                    syncPrices: 'Sync Price Lists',
                    save: 'Save Settings'
                },
                messages: {
                    customerSaved: 'Customer data saved!',
                    fillCustomerFirst: 'Please enter customer data first!',
                    fillSalespersonInfo: 'Please enter salesperson information!',
                    pdfGenerating: 'Generating PDF...',
                    emailSending: 'Sending email...',
                    settingsSaved: 'Settings saved!',
                    connectionSuccess: 'Connection successful!',
                    connectionError: 'Connection error:',
                    syncSuccess: 'Price lists synced!',
                    offerCreated: 'Offer created successfully!',
                    noEmailAddress: 'No email address available!',
                    emailOpened: 'Email program opened. Please attach the PDF manually.',
                    enterBranchData: 'Please enter industry-specific data.',
                    missingAPIToken: 'Please enter API token!',
                    missingXentralData: 'Please enter Xentral credentials!',
                    syncInProgress: 'Syncing price lists...',
                    invalidEmail: 'Please enter a valid email address.',
                    invalidPhone: 'Please enter a valid phone number.',
                    invalidZip: 'Please enter a 5-digit postal code.',
                    requiredField: 'This field is required.'
                },
                calc: {
                    title: 'Revenue Potential Calculation',
                    apply: 'Apply',
                    close: 'Close',
                    hotelCalc: 'Hotel Revenue Potential',
                    nursingCalc: 'Nursing Home Revenue Potential',
                    hospitalCalc: 'Hospital Revenue Potential',
                    canteenCalc: 'Company Restaurant Revenue Potential',
                    restaurantCalc: 'Restaurant Revenue Potential',
                    roomService: 'Room Service',
                    breakfast: 'Breakfast',
                    restaurant: 'Restaurant',
                    standard: 'Standard',
                    private: 'Private',
                    staff: 'Staff',
                    regular: 'Regular Business',
                    events: 'Event Catering',
                    vending: 'Vending',
                    totalPotential: 'Total Potential',
                    realisticTarget: 'Realistic Target',
                    utilization: 'Utilization Rate',
                    ofEmployees: 'of employees'
                },
                pdf: {
                    preview: 'PDF Preview',
                    download: 'Download PDF',
                    close: 'Close',
                    contains: 'The PDF contains:',
                    customer: 'Customer:',
                    targetVolume: 'Target Volume:',
                    contractStart: 'Contract Start:'
                },
                chain: {
                    sizeCategories: 'Size Categories',
                    servicesEquipment: 'Equipment & Services',
                    smallHotel: 'Small (up to 50 rooms)',
                    mediumHotel: 'Medium (51-150 rooms)',
                    largeHotel: 'Large (over 150 rooms)',
                    hotels: 'Hotels',
                    breakfastService: 'Breakfast Service',
                    restaurantAlaCarte: 'Restaurant √† la carte',
                    roomService: 'Room Service',
                    banquetEvents: 'Banquet/Events',
                    smallNursing: 'Small (up to 50 residents)',
                    mediumNursing: 'Medium (51-100 residents)',
                    largeNursing: 'Large (over 100 residents)',
                    homes: 'Homes',
                    fullMeals: 'Full Board (3 meals)',
                    snacks: 'Snacks',
                    smallHospital: 'Small (up to 150 beds)',
                    mediumHospital: 'Medium (151-400 beds)',
                    largeHospital: 'Large (over 400 beds)',
                    clinics: 'Clinics',
                    patientStructure: 'Patient Structure',
                    privatePatientShare: 'Private Patients Share',
                    premiumMealOption: 'Premium Meal Option Available',
                    staffCateringAvailable: 'Staff Catering',
                    smallCanteen: 'Small (up to 200 employees)',
                    mediumCanteen: 'Medium (201-500 employees)',
                    largeCanteen: 'Large (over 500 employees)',
                    locations: 'Locations',
                    serviceScope: 'Service Scope',
                    breakfast: 'Breakfast',
                    lunch: 'Lunch',
                    dinner: 'Dinner',
                    of: 'of'
                },
                yes: 'Yes',
                no: 'No',
                autosave: {
                    saving: 'Saving...',
                    saved: 'Autosaved'
                }
            }
        };

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            try {
                initializeTabs();
                initializeDiscountCalculator();
                initializeCustomerForm();
                initializeLanguageSwitcher();
                initializeValidation();
                initializeAutosave();

                // Set default contract start date to today
                const contractStartEl = document.getElementById('contractStart');
                if (contractStartEl) {
                    try {
                        const today = new Date();
                        const dateStr = today.toISOString().split('T')[0];
                        contractStartEl.value = dateStr;
                        updateContractEnd();
                    } catch (e) {
                        console.warn('Could not set default date:', e);
                    }
                }

                // Load saved settings
                loadSettings();

                // Load default salesperson info
                loadDefaultSalesperson();

                // Update initial language
                updateLanguage();

                // Update progress
                updateProgress();

                // Mark demo as visited after viewing with error handling
                setTimeout(() => {
                    try {
                        tabProgress.demonstrator = true;
                        updateProgress();
                    } catch (e) {
                        console.warn('Progress update error:', e);
                    }
                }, 2000);
            } catch (error) {
                console.error('Initialization error:', error);
                showMessage('Fehler beim Laden. Bitte Seite neu laden.', 'error');
            }
        });

        // Tab Navigation
        function initializeTabs() {
            const tabs = document.querySelectorAll('.nav-tab');
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    switchTab(tabName);
                });
            });
        }

        function switchTab(tabName) {
            // Update active tab
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');

            // Update content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');

            // Update progress
            if (tabName === 'profile') {
                generateCustomerProfile();
            }

            // Mark tab as visited
            tabProgress[tabName] = true;
            updateProgress();
        }

        // Progress Bar
        function updateProgress() {
            const totalTabs = Object.keys(tabProgress).length;
            const completedTabs = Object.values(tabProgress).filter(Boolean).length;
            const progressPercent = (completedTabs / totalTabs) * 100;

            const progressBar = document.getElementById('progressBar');
            if (progressBar) {
                progressBar.style.width = progressPercent + '%';
            }

            // Update tab indicators
            Object.keys(tabProgress).forEach(tab => {
                const tabElement = document.querySelector(`[data-tab="${tab}"]`);
                if (tabElement) {
                    if (tab === 'customer' && customerData.companyName) {
                        tabElement.classList.add('completed');
                    } else if (tab === 'offer' && generatedPdf) {
                        tabElement.classList.add('completed');
                    }
                }
            });
        }

        // Discount Calculator with Debouncing
        function initializeDiscountCalculator() {
            const orderValueSlider = document.getElementById('orderValue');
            const leadTimeSlider = document.getElementById('leadTime');
            const pickupToggle = document.getElementById('pickupToggle');
            const chainToggle = document.getElementById('chainToggle');

            // Debounced update function
            const debouncedUpdate = debounce(updateDiscountCalculation, 150);

            // Add event listeners
            orderValueSlider.addEventListener('input', debouncedUpdate);
            leadTimeSlider.addEventListener('input', debouncedUpdate);
            pickupToggle.addEventListener('change', updateDiscountCalculation);
            chainToggle.addEventListener('change', updateDiscountCalculation);

            // Initial calculation
            updateDiscountCalculation();
            updateScenarios();
        }

        function updateDiscountCalculation() {
            const orderValue = parseInt(document.getElementById('orderValue').value);
            const leadTime = parseInt(document.getElementById('leadTime').value);
            const pickup = document.getElementById('pickupToggle').checked;
            const chain = document.getElementById('chainToggle').checked;

            // Update displays
            document.getElementById('orderValueDisplay').textContent = formatCurrency(orderValue);
            document.getElementById('leadTimeDisplay').textContent = leadTime + ' ' + getTranslation('demo.days');

            // Calculate base discount
            let baseDiscount = 0;
            if (orderValue >= 75000) baseDiscount = 10;
            else if (orderValue >= 50000) baseDiscount = 9;
            else if (orderValue >= 30000) baseDiscount = 8;
            else if (orderValue >= 15000) baseDiscount = 6;
            else if (orderValue >= 5000) baseDiscount = 3;

            // Calculate early booking discount (max 44 days)
            let earlyDiscount = 0;
            if (leadTime >= 30 && leadTime <= 44) earlyDiscount = 3;
            else if (leadTime >= 15) earlyDiscount = 2;
            else if (leadTime >= 10) earlyDiscount = 1;

            // Calculate pickup discount (only from 5000‚Ç¨)
            let pickupDiscount = (pickup && orderValue >= 5000) ? 2 : 0;

            // Update individual discount displays
            document.getElementById('rabattStufe').textContent = 
                `${getTranslation('demo.baseDiscount')}: ${baseDiscount}%`;
            document.getElementById('fr√ºhbucherBonus').textContent = 
                `${getTranslation('demo.earlyBooking')}: ${earlyDiscount}%`;

            // Update pickup bonus display with validation hint
            if (pickup && orderValue < 5000) {
                document.getElementById('pickupBonus').textContent = '+0% (min. 5.000‚Ç¨)';
                document.getElementById('pickupBonus').style.color = 'var(--danger)';
            } else {
                document.getElementById('pickupBonus').textContent = pickup ? '+2%' : '+0%';
                document.getElementById('pickupBonus').style.color = 'inherit';
            }

            // Calculate total discount
            let totalDiscount = baseDiscount + earlyDiscount + pickupDiscount;

            // Calculate savings
            const savings = orderValue * (totalDiscount / 100);
            const finalPrice = orderValue - savings;

            // Update results
            document.getElementById('totalDiscount').textContent = totalDiscount + '%';
            document.getElementById('totalSavings').textContent = formatCurrency(savings);
            document.getElementById('finalPrice').textContent = formatCurrency(finalPrice);

            // Store calculation
            discountCalculation = {
                orderValue,
                leadTime,
                pickup,
                chain,
                baseDiscount,
                earlyDiscount,
                pickupDiscount,
                totalDiscount,
                savings,
                finalPrice
            };
        }

        function updateScenarios() {
            const scenarioGrid = document.getElementById('scenarioGrid');
            const scenarios = [
                {
                    title: getTranslation('demo.spontaneous'),
                    orderValue: 15000,
                    leadTime: 2,
                    pickup: false,
                    discount: 6,
                    savings: 900
                },
                {
                    title: getTranslation('demo.planned'),
                    orderValue: 15000,
                    leadTime: 16,
                    pickup: true,
                    discount: 10,
                    savings: 1500
                },
                {
                    title: getTranslation('demo.optimal'),
                    orderValue: 30000,
                    leadTime: 30,
                    pickup: true,
                    discount: 13,
                    savings: 3900
                },
                {
                    title: getTranslation('demo.kombi'),
                    orderValue: 40000,
                    leadTime: 20,
                    pickup: false,
                    discount: 10,
                    savings: 4000,
                    special: getTranslation('demo.kombiSpecial')
                },
                {
                    title: getTranslation('demo.chainBundle'),
                    orderValue: 60000,
                    leadTime: 15,
                    pickup: false,
                    discount: 11,
                    savings: 6600,
                    special: getTranslation('demo.chainSpecial')
                }
            ];

            scenarioGrid.innerHTML = scenarios.map(scenario => `
                <div class="scenario-card">
                    <div class="scenario-title">${scenario.title}</div>
                    <div class="scenario-details">
                        <div>${getTranslation('demo.orderValue')}: ${formatCurrency(scenario.orderValue)}</div>
                        <div>${getTranslation('demo.leadTime')}: ${scenario.leadTime} ${getTranslation('demo.days')}</div>
                        <div>${scenario.pickup ? getTranslation('demo.pickup') : getTranslation('demo.delivery')}</div>
                        ${scenario.special ? `<div style="color: var(--primary-green); font-weight: bold; margin-top: 0.5rem;">${scenario.special}</div>` : ''}
                    </div>
                    <div class="scenario-savings">${scenario.discount}% = ${formatCurrency(scenario.savings)} ${getTranslation('demo.savings')}</div>
                </div>
            `).join('');
        }

        // Customer Form with Enhanced Validation
        function initializeCustomerForm() {
            // Customer type selection
            const typeOptions = document.querySelectorAll('.type-option');
            typeOptions.forEach(option => {
                option.addEventListener('click', function() {
                    typeOptions.forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                    
                    const isChain = this.getAttribute('data-type') === 'chain';
                    document.getElementById('chainQuickEntry').style.display = isChain ? 'block' : 'none';
                    
                    // Update branch fields when customer type changes
                    updateBranchFields();
                });
            });

            // Industry selection
            document.getElementById('industry').addEventListener('change', updateBranchFields);

            // Vending interest
            document.getElementById('vendingInterest').addEventListener('change', function() {
                document.getElementById('vendingDetails').style.display = this.checked ? 'block' : 'none';
            });

            // Form submission
            document.getElementById('customerForm').addEventListener('submit', function(e) {
                e.preventDefault();
                if (validateCustomerForm()) {
                    saveCustomerData();
                }
            });

            // Contract date handling
            document.getElementById('contractStart').addEventListener('change', updateContractEnd);

            // Chain locations change
            document.getElementById('totalLocations').addEventListener('change', updateChainDetails);
        }

        // Enhanced Validation
        function initializeValidation() {
            // Email validation
            document.getElementById('contactEmail').addEventListener('blur', function() {
                validateEmail(this);
            });
            
            document.getElementById('salespersonEmail').addEventListener('blur', function() {
                validateEmail(this);
            });

            // Phone validation
            document.getElementById('contactPhone').addEventListener('blur', function() {
                validatePhone(this);
            });

            // ZIP code validation
            document.getElementById('zipCode').addEventListener('blur', function() {
                validateZip(this);
            });

            // Required field validation
            document.querySelectorAll('input[required], select[required]').forEach(field => {
                field.addEventListener('blur', function() {
                    validateRequired(this);
                });
            });
        }

        function validateEmail(field) {
            const email = field.value;
            const errorEl = document.getElementById(field.id + 'Error');
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

            if (!email) {
                showFieldError(field, errorEl, getTranslation('messages.requiredField'));
                return false;
            } else if (!emailRegex.test(email)) {
                showFieldError(field, errorEl, getTranslation('messages.invalidEmail'));
                return false;
            } else {
                clearFieldError(field, errorEl);
                return true;
            }
        }

        function validatePhone(field) {
            const phone = field.value;
            const errorEl = document.getElementById(field.id + 'Error');
            const phoneRegex = /^[\d\s\-\+\(\)]+$/;

            if (!phone) {
                showFieldError(field, errorEl, getTranslation('messages.requiredField'));
                return false;
            } else if (!phoneRegex.test(phone) || phone.length < 6) {
                showFieldError(field, errorEl, getTranslation('messages.invalidPhone'));
                return false;
            } else {
                clearFieldError(field, errorEl);
                return true;
            }
        }

        function validateZip(field) {
            const zip = field.value;
            const errorEl = document.getElementById(field.id + 'Error');

            if (!zip) {
                showFieldError(field, errorEl, getTranslation('messages.requiredField'));
                return false;
            } else if (!/^\d{5}$/.test(zip)) {
                showFieldError(field, errorEl, getTranslation('messages.invalidZip'));
                return false;
            } else {
                clearFieldError(field, errorEl);
                return true;
            }
        }

        function validateRequired(field) {
            const errorEl = document.getElementById(field.id + 'Error');
            
            if (!field.value.trim()) {
                showFieldError(field, errorEl, getTranslation('messages.requiredField'));
                return false;
            } else {
                clearFieldError(field, errorEl);
                return true;
            }
        }

        function showFieldError(field, errorEl, message) {
            field.classList.add('error');
            if (errorEl) {
                errorEl.textContent = message;
                errorEl.classList.add('show');
            }
        }

        function clearFieldError(field, errorEl) {
            field.classList.remove('error');
            if (errorEl) {
                errorEl.classList.remove('show');
            }
        }

        function validateCustomerForm() {
            let isValid = true;

            // Validate all required fields
            document.querySelectorAll('#customerForm input[required], #customerForm select[required]').forEach(field => {
                if (field.type === 'email') {
                    if (!validateEmail(field)) isValid = false;
                } else if (field.id === 'contactPhone') {
                    if (!validatePhone(field)) isValid = false;
                } else if (field.id === 'zipCode') {
                    if (!validateZip(field)) isValid = false;
                } else {
                    if (!validateRequired(field)) isValid = false;
                }
            });

            return isValid;
        }

        // Autosave Functionality
        function initializeAutosave() {
            // Add autosave to all marked fields
            document.querySelectorAll('[data-autosave="true"]').forEach(field => {
                field.addEventListener('input', debounce(function() {
                    autosaveData();
                }, 1000));
            });
        }

        function autosaveData() {
            const indicator = document.getElementById('autosaveIndicator');
            const indicatorText = document.getElementById('autosaveText');

            // Show saving indicator
            indicator.classList.add('saving', 'show');
            indicatorText.textContent = getTranslation('autosave.saving');

            // Collect form data
            const formData = {
                companyName: document.getElementById('companyName').value,
                legalForm: document.getElementById('legalForm').value,
                contactName: document.getElementById('contactName').value,
                contactPosition: document.getElementById('contactPosition').value,
                contactEmail: document.getElementById('contactEmail').value,
                contactPhone: document.getElementById('contactPhone').value,
                street: document.getElementById('street').value,
                zipCode: document.getElementById('zipCode').value,
                city: document.getElementById('city').value,
                industry: document.getElementById('industry').value,
                targetRevenue: document.getElementById('targetRevenue').value,
                vendingInterest: document.getElementById('vendingInterest').checked,
                timestamp: new Date().toISOString()
            };

            // Save to storage
            storage.setItem('freshplanAutosave', JSON.stringify(formData));

            // Show saved indicator
            setTimeout(() => {
                indicator.classList.remove('saving');
                indicatorText.textContent = getTranslation('autosave.saved');
                
                // Hide after 2 seconds
                setTimeout(() => {
                    indicator.classList.remove('show');
                }, 2000);
            }, 500);
        }

        function loadAutosavedData() {
            const savedData = storage.getItem('freshplanAutosave');
            if (savedData) {
                try {
                    const data = JSON.parse(savedData);
                    
                    // Restore form fields
                    Object.keys(data).forEach(key => {
                        const field = document.getElementById(key);
                        if (field) {
                            if (field.type === 'checkbox') {
                                field.checked = data[key];
                            } else {
                                field.value = data[key];
                            }
                        }
                    });

                    // Show restore message
                    const timestamp = new Date(data.timestamp);
                    const timeAgo = Math.floor((new Date() - timestamp) / 60000);
                    showMessage(`Automatisch gespeicherte Daten wiederhergestellt (vor ${timeAgo} Minuten)`, 'success');
                } catch (e) {
                    console.warn('Could not restore autosaved data:', e);
                }
            }
        }

        function updateBranchFields() {
            const industry = document.getElementById('industry').value;
            const container = document.getElementById('branchSpecificFields');
            const chainContainer = document.getElementById('chainCategorization');
            const isChain = document.querySelector('.type-option.selected').getAttribute('data-type') === 'chain';

            // Clear existing fields
            container.innerHTML = '';
            chainContainer.innerHTML = '';

            if (!industry) return;

            // Only show single location fields if NOT a chain
            if (!isChain) {
                // Add industry-specific fields for single locations
                switch(industry) {
                    case 'hotel':
                        container.innerHTML = `
                            <h3>${getTranslation('customer.hotelSpecific')}</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>${getTranslation('customer.rooms')}</label>
                                    <input type="number" id="hotelRooms" min="1" data-autosave="true">
                                </div>
                                <div class="form-group">
                                    <label>${getTranslation('customer.restaurantSeats')}</label>
                                    <input type="number" id="restaurantSeats" min="0" data-autosave="true">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>${getTranslation('customer.occupancy')}</label>
                                    <input type="number" id="occupancyRate" min="0" max="100" value="75" data-autosave="true">
                                </div>
                                <div class="form-group">
                                    <label>${getTranslation('customer.breakfastGuests')}</label>
                                    <input type="number" id="breakfastGuests" min="0" data-autosave="true">
                                </div>
                            </div>
                        `;
                        break;

                    case 'altenheim':
                        container.innerHTML = `
                            <h3>${getTranslation('customer.nursingSpecific')}</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>${getTranslation('customer.residents')}</label>
                                    <input type="number" id="residents" min="1" data-autosave="true">
                                </div>
                                <div class="form-group">
                                    <label>${getTranslation('customer.mealsPerDay')}</label>
                                    <input type="number" id="mealsPerDay" min="1" max="5" value="3" data-autosave="true">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>${getTranslation('customer.specialDiets')}</label>
                                    <input type="number" id="specialDiets" min="0" max="100" value="30" data-autosave="true">
                                </div>
                                <div class="form-group">
                                    <label>${getTranslation('customer.consistency')}</label>
                                    <select id="consistencyLevels" data-autosave="true">
                                        <option value="yes">${getTranslation('yes')}</option>
                                        <option value="no">${getTranslation('no')}</option>
                                    </select>
                                </div>
                            </div>
                        `;
                        break;

                    case 'krankenhaus':
                        container.innerHTML = `
                            <h3>${getTranslation('customer.hospitalSpecific')}</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>${getTranslation('customer.beds')}</label>
                                    <input type="number" id="hospitalBeds" min="1" data-autosave="true">
                                </div>
                                <div class="form-group">
                                    <label>${getTranslation('customer.bedOccupancy')}</label>
                                    <input type="number" id="bedOccupancy" min="0" max="100" value="85" data-autosave="true">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>${getTranslation('customer.privateRatio')}</label>
                                    <input type="number" id="privatePatientsRatio" min="0" max="100" value="15" data-autosave="true">
                                </div>
                                <div class="form-group">
                                    <label>${getTranslation('customer.premiumMeals')}</label>
                                    <select id="premiumMeals" data-autosave="true">
                                        <option value="yes">${getTranslation('yes')}</option>
                                        <option value="no">${getTranslation('no')}</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>${getTranslation('customer.staffCatering')}</label>
                                    <select id="staffCatering" data-autosave="true">
                                        <option value="yes">${getTranslation('yes')}</option>
                                        <option value="no">${getTranslation('no')}</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>${getTranslation('customer.publicCafeteria')}</label>
                                    <select id="publicCafeteria" data-autosave="true">
                                        <option value="yes">${getTranslation('yes')}</option>
                                        <option value="no">${getTranslation('no')}</option>
                                    </select>
                                </div>
                            </div>
                        `;
                        break;

                    case 'betriebsrestaurant':
                        container.innerHTML = `
                            <h3>${getTranslation('customer.canteenSpecific')}</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>${getTranslation('customer.employees')}</label>
                                    <input type="number" id="employees" min="1" data-autosave="true">
                                </div>
                                <div class="form-group">
                                    <label>${getTranslation('customer.dailyDiners')}</label>
                                    <input type="number" id="dailyDiners" min="1" data-autosave="true">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>${getTranslation('customer.operatingDays')}</label>
                                    <input type="number" id="operatingDays" min="1" max="365" value="250" data-autosave="true">
                                </div>
                                <div class="form-group">
                                    <label>${getTranslation('customer.subsidized')}</label>
                                    <select id="subsidized" data-autosave="true">
                                        <option value="yes">${getTranslation('yes')}</option>
                                        <option value="no">${getTranslation('no')}</option>
                                    </select>
                                </div>
                            </div>
                        `;
                        break;

                    case 'restaurant':
                        container.innerHTML = `
                            <h3>${getTranslation('customer.restaurantSpecific')}</h3>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>${getTranslation('customer.seats')}</label>
                                    <input type="number" id="seats" min="1" data-autosave="true">
                                </div>
                                <div class="form-group">
                                    <label>${getTranslation('customer.dailyGuests')}</label>
                                    <input type="number" id="dailyGuests" min="1" data-autosave="true">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label>${getTranslation('customer.eventCatering')}</label>
                                    <select id="eventCatering" data-autosave="true">
                                        <option value="yes">${getTranslation('yes')}</option>
                                        <option value="no">${getTranslation('no')}</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label>${getTranslation('customer.branches')}</label>
                                    <input type="number" id="branches" min="1" value="1" data-autosave="true">
                                </div>
                            </div>
                        `;
                        break;
                }

                // Re-initialize autosave for new fields
                container.querySelectorAll('[data-autosave="true"]').forEach(field => {
                    field.addEventListener('input', debounce(function() {
                        autosaveData();
                    }, 1000));
                });
            } else {
                // Show chain categorization for chains
                switch(industry) {
                    case 'hotel':
                        chainContainer.innerHTML = `
                            <h4>${getTranslation('chain.sizeCategories')}</h4>
                            <div class="size-category">
                                <label>${getTranslation('chain.smallHotel')}</label>
                                <input type="number" class="number-input" id="smallHotels" min="0" value="0">
                                <span>${getTranslation('chain.hotels')}</span>
                            </div>
                            <div class="size-category">
                                <label>${getTranslation('chain.mediumHotel')}</label>
                                <input type="number" class="number-input" id="mediumHotels" min="0" value="0">
                                <span>${getTranslation('chain.hotels')}</span>
                            </div>
                            <div class="size-category">
                                <label>${getTranslation('chain.largeHotel')}</label>
                                <input type="number" class="number-input" id="largeHotels" min="0" value="0">
                                <span>${getTranslation('chain.hotels')}</span>
                            </div>
                            <div class="service-matrix">
                                <h4>${getTranslation('chain.servicesEquipment')}</h4>
                                <div class="service-row">
                                    <label>${getTranslation('chain.breakfastService')}</label>
                                    <input type="number" id="hotelsBreakfast" min="0" class="number-input">
                                    <span>${getTranslation('chain.of')} <span id="totalHotelsCount">0</span> ${getTranslation('chain.hotels')}</span>
                                </div>
                                <div class="service-row">
                                    <label>${getTranslation('chain.restaurantAlaCarte')}</label>
                                    <input type="number" id="hotelsRestaurant" min="0" class="number-input">
                                    <span>${getTranslation('chain.of')} <span class="totalHotelsCount">0</span> ${getTranslation('chain.hotels')}</span>
                                </div>
                                <div class="service-row">
                                    <label>${getTranslation('chain.roomService')}</label>
                                    <input type="number" id="hotelsRoomService" min="0" class="number-input">
                                    <span>${getTranslation('chain.of')} <span class="totalHotelsCount">0</span> ${getTranslation('chain.hotels')}</span>
                                </div>
                                <div class="service-row">
                                    <label>${getTranslation('chain.banquetEvents')}</label>
                                    <input type="number" id="hotelsBanquet" min="0" class="number-input">
                                    <span>${getTranslation('chain.of')} <span class="totalHotelsCount">0</span> ${getTranslation('chain.hotels')}</span>
                                </div>
                            </div>
                        `;
                        
                        // Add event listeners for chain calculations
                        setTimeout(() => {
                            ['smallHotels', 'mediumHotels', 'largeHotels'].forEach(id => {
                                document.getElementById(id).addEventListener('input', updateHotelCount);
                            });
                        }, 100);
                        break;

                    case 'altenheim':
                        chainContainer.innerHTML = `
                            <h4>${getTranslation('chain.sizeCategories')}</h4>
                            <div class="size-category">
                                <label>${getTranslation('chain.smallNursing')}</label>
                                <input type="number" class="number-input" id="smallNursing" min="0" value="0">
                                <span>${getTranslation('chain.homes')}</span>
                            </div>
                            <div class="size-category">
                                <label>${getTranslation('chain.mediumNursing')}</label>
                                <input type="number" class="number-input" id="mediumNursing" min="0" value="0">
                                <span>${getTranslation('chain.homes')}</span>
                            </div>
                            <div class="size-category">
                                <label>${getTranslation('chain.largeNursing')}</label>
                                <input type="number" class="number-input" id="largeNursing" min="0" value="0">
                                <span>${getTranslation('chain.homes')}</span>
                            </div>
                            <div class="service-matrix">
                                <h4>${getTranslation('chain.servicesEquipment')}</h4>
                                <div class="service-row">
                                    <label>${getTranslation('chain.fullMeals')}</label>
                                    <input type="number" id="nursingFullService" min="0" class="number-input">
                                    <span>${getTranslation('chain.of')} <span id="totalNursingCount">0</span> ${getTranslation('chain.homes')}</span>
                                </div>
                                <div class="service-row">
                                    <label>${getTranslation('chain.snacks')}</label>
                                    <input type="number" id="nursingSnacks" min="0" class="number-input">
                                    <span>${getTranslation('chain.of')} <span class="totalNursingCount">0</span> ${getTranslation('chain.homes')}</span>
                                </div>
                            </div>
                        `;
                        
                        setTimeout(() => {
                            ['smallNursing', 'mediumNursing', 'largeNursing'].forEach(id => {
                                document.getElementById(id).addEventListener('input', updateNursingCount);
                            });
                        }, 100);
                        break;

                    case 'krankenhaus':
                        chainContainer.innerHTML = `
                            <h4>${getTranslation('chain.sizeCategories')}</h4>
                            <div class="size-category">
                                <label>${getTranslation('chain.smallHospital')}</label>
                                <input type="number" class="number-input" id="smallHospitals" min="0" value="0">
                                <span>${getTranslation('chain.clinics')}</span>
                            </div>
                            <div class="size-category">
                                <label>${getTranslation('chain.mediumHospital')}</label>
                                <input type="number" class="number-input" id="mediumHospitals" min="0" value="0">
                                <span>${getTranslation('chain.clinics')}</span>
                            </div>
                            <div class="size-category">
                                <label>${getTranslation('chain.largeHospital')}</label>
                                <input type="number" class="number-input" id="largeHospitals" min="0" value="0">
                                <span>${getTranslation('chain.clinics')}</span>
                            </div>
                            <div class="service-matrix">
                                <h4>${getTranslation('chain.patientStructure')}</h4>
                                <div class="service-row">
                                    <label>${getTranslation('chain.privatePatientShare')}</label>
                                    <input type="number" id="chainPrivatePatients" min="0" max="100" value="15" class="number-input">
                                    <span>%</span>
                                </div>
                                <div class="service-row">
                                    <label>${getTranslation('chain.premiumMealOption')}</label>
                                    <input type="number" id="hospitalsPremium" min="0" class="number-input">
                                    <span>${getTranslation('chain.of')} <span id="totalHospitalCount">0</span> ${getTranslation('chain.clinics')}</span>
                                </div>
                                <div class="service-row">
                                    <label>${getTranslation('chain.staffCateringAvailable')}</label>
                                    <input type="number" id="hospitalsStaff" min="0" class="number-input">
                                    <span>${getTranslation('chain.of')} <span class="totalHospitalCount">0</span> ${getTranslation('chain.clinics')}</span>
                                </div>
                            </div>
                        `;
                        
                        setTimeout(() => {
                            ['smallHospitals', 'mediumHospitals', 'largeHospitals'].forEach(id => {
                                document.getElementById(id).addEventListener('input', updateHospitalCount);
                            });
                        }, 100);
                        break;

                    case 'betriebsrestaurant':
                        chainContainer.innerHTML = `
                            <h4>${getTranslation('chain.sizeCategories')}</h4>
                            <div class="size-category">
                                <label>${getTranslation('chain.smallCanteen')}</label>
                                <input type="number" class="number-input" id="smallCanteens" min="0" value="0">
                                <span>${getTranslation('chain.locations')}</span>
                            </div>
                            <div class="size-category">
                                <label>${getTranslation('chain.mediumCanteen')}</label>
                                <input type="number" class="number-input" id="mediumCanteens" min="0" value="0">
                                <span>${getTranslation('chain.locations')}</span>
                            </div>
                            <div class="size-category">
                                <label>${getTranslation('chain.largeCanteen')}</label>
                                <input type="number" class="number-input" id="largeCanteens" min="0" value="0">
                                <span>${getTranslation('chain.locations')}</span>
                            </div>
                            <div class="service-matrix">
                                <h4>${getTranslation('chain.serviceScope')}</h4>
                                <div class="service-row">
                                    <label>${getTranslation('chain.breakfast')}</label>
                                    <input type="number" id="canteensBreakfast" min="0" class="number-input">
                                    <span>${getTranslation('chain.of')} <span id="totalCanteenCount">0</span> ${getTranslation('chain.locations')}</span>
                                </div>
                                <div class="service-row">
                                    <label>${getTranslation('chain.lunch')}</label>
                                    <input type="number" id="canteensLunch" min="0" class="number-input">
                                    <span>${getTranslation('chain.of')} <span class="totalCanteenCount">0</span> ${getTranslation('chain.locations')}</span>
                                </div>
                                <div class="service-row">
                                    <label>${getTranslation('chain.dinner')}</label>
                                    <input type="number" id="canteensDinner" min="0" class="number-input">
                                    <span>${getTranslation('chain.of')} <span class="totalCanteenCount">0</span> ${getTranslation('chain.locations')}</span>
                                </div>
                            </div>
                        `;
                        
                        setTimeout(() => {
                            ['smallCanteens', 'mediumCanteens', 'largeCanteens'].forEach(id => {
                                document.getElementById(id).addEventListener('input', updateCanteenCount);
                            });
                        }, 100);
                        break;
                }
            }
        }

        // Chain Count Update Functions
        function updateHotelCount() {
            const small = parseInt(document.getElementById('smallHotels').value) || 0;
            const medium = parseInt(document.getElementById('mediumHotels').value) || 0;
            const large = parseInt(document.getElementById('largeHotels').value) || 0;
            const total = small + medium + large;
            
            document.querySelectorAll('#totalHotelsCount, .totalHotelsCount').forEach(el => {
                el.textContent = total;
            });
            
            // Update total locations
            document.getElementById('totalLocations').value = total;
        }

        function updateNursingCount() {
            const small = parseInt(document.getElementById('smallNursing').value) || 0;
            const medium = parseInt(document.getElementById('mediumNursing').value) || 0;
            const large = parseInt(document.getElementById('largeNursing').value) || 0;
            const total = small + medium + large;
            
            document.querySelectorAll('#totalNursingCount, .totalNursingCount').forEach(el => {
                el.textContent = total;
            });
            
            document.getElementById('totalLocations').value = total;
        }

        function updateHospitalCount() {
            const small = parseInt(document.getElementById('smallHospitals').value) || 0;
            const medium = parseInt(document.getElementById('mediumHospitals').value) || 0;
            const large = parseInt(document.getElementById('largeHospitals').value) || 0;
            const total = small + medium + large;
            
            document.querySelectorAll('#totalHospitalCount, .totalHospitalCount').forEach(el => {
                el.textContent = total;
            });
            
            document.getElementById('totalLocations').value = total;
        }

        function updateCanteenCount() {
            const small = parseInt(document.getElementById('smallCanteens').value) || 0;
            const medium = parseInt(document.getElementById('mediumCanteens').value) || 0;
            const large = parseInt(document.getElementById('largeCanteens').value) || 0;
            const total = small + medium + large;
            
            document.querySelectorAll('#totalCanteenCount, .totalCanteenCount').forEach(el => {
                el.textContent = total;
            });
            
            document.getElementById('totalLocations').value = total;
        }

        function toggleChainDetails() {
            const detail = document.getElementById('chainLocationsDetail');
            detail.style.display = detail.style.display === 'none' ? 'block' : 'none';
            
            if (detail.style.display === 'block') {
                updateChainDetails();
            }
        }

        function updateChainDetails() {
            const totalLocations = parseInt(document.getElementById('totalLocations').value) || 0;
            const industry = document.getElementById('industry').value;
            const detail = document.getElementById('chainLocationsDetail');
            
            if (totalLocations === 0) {
                detail.innerHTML = '<p>Bitte geben Sie die Anzahl der Standorte ein.</p>';
                return;
            }
            
            // Generate location details based on industry
            let locationHTML = '';
            for (let i = 1; i <= totalLocations; i++) {
                locationHTML += `
                    <div class="location-item">
                        <div class="location-header" onclick="toggleLocationDetail(${i})">
                            <h4>Standort ${i}</h4>
                            <span>‚ñº</span>
                        </div>
                        <div id="location-detail-${i}" class="location-details">
                            <div class="form-row">
                                <div class="form-group">
                                    <label>Standortname</label>
                                    <input type="text" id="location-name-${i}" placeholder="z.B. ${industry === 'hotel' ? 'Hotel Berlin' : 'Standort Berlin'}">
                                </div>
                                <div class="form-group">
                                    <label>PLZ</label>
                                    <input type="text" id="location-zip-${i}" maxlength="5">
                                </div>
                            </div>
                            ${getIndustrySpecificLocationFields(industry, i)}
                        </div>
                    </div>
                `;
            }
            
            detail.innerHTML = locationHTML;
        }

        function toggleLocationDetail(index) {
            const detail = document.getElementById(`location-detail-${index}`);
            detail.style.display = detail.style.display === 'none' ? 'block' : 'none';
        }

        function getIndustrySpecificLocationFields(industry, index) {
            switch(industry) {
                case 'hotel':
                    return `
                        <div class="form-row">
                            <div class="form-group">
                                <label>Zimmer</label>
                                <input type="number" id="location-rooms-${index}" min="1">
                            </div>
                            <div class="form-group">
                                <label>Sterne</label>
                                <select id="location-stars-${index}">
                                    <option value="3">3 Sterne</option>
                                    <option value="4">4 Sterne</option>
                                    <option value="5">5 Sterne</option>
                                </select>
                            </div>
                        </div>
                    `;
                case 'altenheim':
                    return `
                        <div class="form-row">
                            <div class="form-group">
                                <label>Bewohner</label>
                                <input type="number" id="location-residents-${index}" min="1">
                            </div>
                            <div class="form-group">
                                <label>Pflegegrade</label>
                                <select id="location-care-${index}">
                                    <option value="mixed">Gemischt</option>
                                    <option value="high">Schwerpunkt 3-5</option>
                                </select>
                            </div>
                        </div>
                    `;
                case 'krankenhaus':
                    return `
                        <div class="form-row">
                            <div class="form-group">
                                <label>Betten</label>
                                <input type="number" id="location-beds-${index}" min="1">
                            </div>
                            <div class="form-group">
                                <label>Fachrichtung</label>
                                <input type="text" id="location-specialty-${index}" placeholder="z.B. Kardiologie">
                            </div>
                        </div>
                    `;
                case 'betriebsrestaurant':
                    return `
                        <div class="form-row">
                            <div class="form-group">
                                <label>Mitarbeiter</label>
                                <input type="number" id="location-employees-${index}" min="1">
                            </div>
                            <div class="form-group">
                                <label>Sitzpl√§tze</label>
                                <input type="number" id="location-seats-${index}" min="1">
                            </div>
                        </div>
                    `;
                default:
                    return '';
            }
        }

        // Save Customer Data
        function saveCustomerData() {
            // Collect all form data
            customerData = {
                // Basic data
                companyName: document.getElementById('companyName').value,
                legalForm: document.getElementById('legalForm').value,
                customerType: document.querySelector('.type-option.selected').getAttribute('data-type'),
                
                // Contact
                contactName: document.getElementById('contactName').value,
                contactPosition: document.getElementById('contactPosition').value,
                contactEmail: document.getElementById('contactEmail').value,
                contactPhone: document.getElementById('contactPhone').value,
                
                // Address
                street: document.getElementById('street').value,
                zipCode: document.getElementById('zipCode').value,
                city: document.getElementById('city').value,
                
                // Business
                industry: document.getElementById('industry').value,
                targetRevenue: parseFloat(document.getElementById('targetRevenue').value),
                
                // Vending
                vendingInterest: document.getElementById('vendingInterest').checked,
                vendingLocations: document.getElementById('vendingLocations')?.value || 0,
                vendingDaily: document.getElementById('vendingDaily')?.value || 0,
                
                // Timestamp
                savedAt: new Date().toISOString()
            };
            
            // Collect industry-specific data
            collectIndustrySpecificData();
            
            // Collect chain data if applicable
            if (customerData.customerType === 'chain') {
                collectChainData();
            }
            
            // Save to storage
            storage.setItem('freshplanCustomerData', JSON.stringify(customerData));
            
            // Update UI
            showMessage(getTranslation('messages.customerSaved'), 'success');
            tabProgress.customer = true;
            updateProgress();
            
            // Clear autosave
            storage.removeItem('freshplanAutosave');
        }

        function collectIndustrySpecificData() {
            const industry = customerData.industry;
            
            switch(industry) {
                case 'hotel':
                    customerData.hotelRooms = document.getElementById('hotelRooms')?.value || 0;
                    customerData.restaurantSeats = document.getElementById('restaurantSeats')?.value || 0;
                    customerData.occupancyRate = document.getElementById('occupancyRate')?.value || 75;
                    customerData.breakfastGuests = document.getElementById('breakfastGuests')?.value || 0;
                    break;
                    
                case 'altenheim':
                    customerData.residents = document.getElementById('residents')?.value || 0;
                    customerData.mealsPerDay = document.getElementById('mealsPerDay')?.value || 3;
                    customerData.specialDiets = document.getElementById('specialDiets')?.value || 30;
                    customerData.consistencyLevels = document.getElementById('consistencyLevels')?.value || 'no';
                    break;
                    
                case 'krankenhaus':
                    customerData.hospitalBeds = document.getElementById('hospitalBeds')?.value || 0;
                    customerData.bedOccupancy = document.getElementById('bedOccupancy')?.value || 85;
                    customerData.privatePatientsRatio = document.getElementById('privatePatientsRatio')?.value || 15;
                    customerData.premiumMeals = document.getElementById('premiumMeals')?.value || 'no';
                    customerData.staffCatering = document.getElementById('staffCatering')?.value || 'no';
                    customerData.publicCafeteria = document.getElementById('publicCafeteria')?.value || 'no';
                    break;
                    
                case 'betriebsrestaurant':
                    customerData.employees = document.getElementById('employees')?.value || 0;
                    customerData.dailyDiners = document.getElementById('dailyDiners')?.value || 0;
                    customerData.operatingDays = document.getElementById('operatingDays')?.value || 250;
                    customerData.subsidized = document.getElementById('subsidized')?.value || 'no';
                    break;
                    
                case 'restaurant':
                    customerData.seats = document.getElementById('seats')?.value || 0;
                    customerData.dailyGuests = document.getElementById('dailyGuests')?.value || 0;
                    customerData.eventCatering = document.getElementById('eventCatering')?.value || 'no';
                    customerData.branches = document.getElementById('branches')?.value || 1;
                    break;
            }
        }

        function collectChainData() {
            customerData.totalLocations = document.getElementById('totalLocations')?.value || 0;
            customerData.chainData = {};
            
            const industry = customerData.industry;
            
            switch(industry) {
                case 'hotel':
                    customerData.chainData = {
                        small: document.getElementById('smallHotels')?.value || 0,
                        medium: document.getElementById('mediumHotels')?.value || 0,
                        large: document.getElementById('largeHotels')?.value || 0,
                        services: {
                            breakfast: document.getElementById('hotelsBreakfast')?.value || 0,
                            restaurant: document.getElementById('hotelsRestaurant')?.value || 0,
                            roomService: document.getElementById('hotelsRoomService')?.value || 0,
                            banquet: document.getElementById('hotelsBanquet')?.value || 0
                        }
                    };
                    break;
                    
                case 'altenheim':
                    customerData.chainData = {
                        small: document.getElementById('smallNursing')?.value || 0,
                        medium: document.getElementById('mediumNursing')?.value || 0,
                        large: document.getElementById('largeNursing')?.value || 0,
                        services: {
                            fullService: document.getElementById('nursingFullService')?.value || 0,
                            snacks: document.getElementById('nursingSnacks')?.value || 0
                        }
                    };
                    break;
                    
                case 'krankenhaus':
                    customerData.chainData = {
                        small: document.getElementById('smallHospitals')?.value || 0,
                        medium: document.getElementById('mediumHospitals')?.value || 0,
                        large: document.getElementById('largeHospitals')?.value || 0,
                        privatePatients: document.getElementById('chainPrivatePatients')?.value || 15,
                        services: {
                            premium: document.getElementById('hospitalsPremium')?.value || 0,
                            staff: document.getElementById('hospitalsStaff')?.value || 0
                        }
                    };
                    break;
                    
                case 'betriebsrestaurant':
                    customerData.chainData = {
                        small: document.getElementById('smallCanteens')?.value || 0,
                        medium: document.getElementById('mediumCanteens')?.value || 0,
                        large: document.getElementById('largeCanteens')?.value || 0,
                        services: {
                            breakfast: document.getElementById('canteensBreakfast')?.value || 0,
                            lunch: document.getElementById('canteensLunch')?.value || 0,
                            dinner: document.getElementById('canteensDinner')?.value || 0
                        }
                    };
                    break;
            }
        }

        // Revenue Potential Calculator
        function calculatePotential() {
            const industry = document.getElementById('industry').value;
            
            if (!industry) {
                showMessage(getTranslation('messages.enterBranchData'), 'error');
                return;
            }
            
            let potential = 0;
            let breakdown = {};
            
            switch(industry) {
                case 'hotel':
                    potential = calculateHotelPotential();
                    break;
                case 'altenheim':
                    potential = calculateNursingPotential();
                    break;
                case 'krankenhaus':
                    potential = calculateHospitalPotential();
                    break;
                case 'betriebsrestaurant':
                    potential = calculateCanteenPotential();
                    break;
                case 'restaurant':
                    potential = calculateRestaurantPotential();
                    break;
            }
            
            showCalculationModal(potential);
        }

        function calculateHotelPotential() {
            const rooms = parseInt(document.getElementById('hotelRooms')?.value) || 0;
            const occupancy = (parseInt(document.getElementById('occupancyRate')?.value) || 75) / 100;
            const restaurantSeats = parseInt(document.getElementById('restaurantSeats')?.value) || 0;
            const breakfastGuests = parseInt(document.getElementById('breakfastGuests')?.value) || 0;
            
            const breakdown = {
                roomService: rooms * occupancy * 365 * 0.1 * 25, // 10% order room service, 25‚Ç¨ average
                breakfast: breakfastGuests * 365 * 8, // 8‚Ç¨ per breakfast
                restaurant: restaurantSeats * 0.6 * 365 * 35 // 60% utilization, 35‚Ç¨ average
            };
            
            const total = Object.values(breakdown).reduce((a, b) => a + b, 0);
            
            return {
                total: Math.round(total),
                breakdown: breakdown,
                realistic: Math.round(total * 0.3) // 30% market share
            };
        }

        function calculateNursingPotential() {
            const residents = parseInt(document.getElementById('residents')?.value) || 0;
            const mealsPerDay = parseInt(document.getElementById('mealsPerDay')?.value) || 3;
            
            const breakdown = {
                standard: residents * 0.7 * mealsPerDay * 365 * 4.5, // 70% standard meals, 4.50‚Ç¨
                special: residents * 0.3 * mealsPerDay * 365 * 5.5 // 30% special diets, 5.50‚Ç¨
            };
            
            const total = Object.values(breakdown).reduce((a, b) => a + b, 0);
            
            return {
                total: Math.round(total),
                breakdown: breakdown,
                realistic: Math.round(total * 0.4) // 40% market share
            };
        }

        function calculateHospitalPotential() {
            const beds = parseInt(document.getElementById('hospitalBeds')?.value) || 0;
            const occupancy = (parseInt(document.getElementById('bedOccupancy')?.value) || 85) / 100;
            const privateRatio = (parseInt(document.getElementById('privatePatientsRatio')?.value) || 15) / 100;
            const staffCatering = document.getElementById('staffCatering')?.value === 'yes';
            
            const breakdown = {
                standard: beds * occupancy * (1 - privateRatio) * 365 * 12, // Standard patients
                private: beds * occupancy * privateRatio * 365 * 25, // Private patients
                staff: staffCatering ? beds * 2.5 * 250 * 6 : 0 // 2.5 staff per bed, 250 days, 6‚Ç¨
            };
            
            const total = Object.values(breakdown).reduce((a, b) => a + b, 0);
            
            return {
                total: Math.round(total),
                breakdown: breakdown,
                realistic: Math.round(total * 0.35) // 35% market share
            };
        }

        function calculateCanteenPotential() {
            const employees = parseInt(document.getElementById('employees')?.value) || 0;
            const dailyDiners = parseInt(document.getElementById('dailyDiners')?.value) || 0;
            const operatingDays = parseInt(document.getElementById('operatingDays')?.value) || 250;
            
            const utilization = dailyDiners / employees;
            const avgPrice = 7.5; // Average price per meal
            
            const breakdown = {
                regular: dailyDiners * operatingDays * avgPrice
            };
            
            const total = breakdown.regular;
            
            return {
                total: Math.round(total),
                breakdown: breakdown,
                realistic: Math.round(total * 0.5), // 50% market share
                utilization: Math.round(utilization * 100)
            };
        }

        function calculateRestaurantPotential() {
            const seats = parseInt(document.getElementById('seats')?.value) || 0;
            const dailyGuests = parseInt(document.getElementById('dailyGuests')?.value) || 0;
            const eventCatering = document.getElementById('eventCatering')?.value === 'yes';
            
            const breakdown = {
                regular: dailyGuests * 310 * 8, // 310 operating days, 8‚Ç¨ ingredient cost
                events: eventCatering ? seats * 52 * 20 : 0 // Weekly event, 20‚Ç¨ per person
            };
            
            const total = Object.values(breakdown).reduce((a, b) => a + b, 0);
            
            return {
                total: Math.round(total),
                breakdown: breakdown,
                realistic: Math.round(total * 0.25) // 25% market share
            };
        }

        function showCalculationModal(result) {
            const modal = document.getElementById('calcModal');
            const content = document.getElementById('calcContent');
            const industry = document.getElementById('industry').value;
            
            let html = `<h3>${getTranslation('calc.' + industry + 'Calc')}</h3>`;
            
            // Show breakdown
            html += '<div class="calc-breakdown">';
            for (const [key, value] of Object.entries(result.breakdown)) {
                if (value > 0) {
                    html += `
                        <div class="calc-line">
                            <span>${getTranslation('calc.' + key) || key}:</span>
                            <span>${formatCurrency(value)}</span>
                        </div>
                    `;
                }
            }
            html += '</div>';
            
            // Show totals
            html += `
                <div class="calc-breakdown" style="margin-top: 1rem; border-top: 2px solid white; padding-top: 1rem;">
                    <div class="calc-line" style="font-size: 1.2rem;">
                        <span>${getTranslation('calc.totalPotential')}:</span>
                        <span>${formatCurrency(result.total)}</span>
                    </div>
                    <div class="calc-line" style="font-size: 1.5rem; font-weight: bold;">
                        <span>${getTranslation('calc.realisticTarget')}:</span>
                        <span>${formatCurrency(result.realistic)}</span>
                    </div>
                </div>
            `;
            
            // Show utilization for canteens
            if (result.utilization !== undefined) {
                html += `
                    <div class="info-box" style="margin-top: 1rem;">
                        <p>${getTranslation('calc.utilization')}: ${result.utilization}% ${getTranslation('calc.ofEmployees')}</p>
                    </div>
                `;
            }
            
            content.innerHTML = html;
            modal.style.display = 'block';
            
            // Store calculated revenue
            calculatedRevenue = result.realistic;
        }

        function applyCalculation() {
            document.getElementById('targetRevenue').value = calculatedRevenue;
            closeCalcModal();
            showMessage('Kalkulierter Umsatz wurde √ºbernommen!', 'success');
        }

        function closeCalcModal() {
            document.getElementById('calcModal').style.display = 'none';
        }

        // Customer Profile Generation
        function generateCustomerProfile() {
            const savedData = storage.getItem('freshplanCustomerData');
            
            if (!savedData) {
                document.getElementById('profileOverview').style.display = 'none';
                document.getElementById('profileEmpty').style.display = 'block';
                return;
            }
            
            customerData = JSON.parse(savedData);
            
            document.getElementById('profileOverview').style.display = 'block';
            document.getElementById('profileEmpty').style.display = 'none';
            
            // Generate profile sections
            generateBasicInfo();
            generatePotentialAnalysis();
            generateSalesStrategy();
            generateKeyArguments();
            generateNextSteps();
        }

        function generateBasicInfo() {
            const container = document.getElementById('profileBasicInfo');
            const typeText = customerData.customerType === 'chain' ? 'Kette/Gruppe' : 'Einzelstandort';
            const industryText = getIndustryName(customerData.industry);
            
            container.innerHTML = `
                <div class="profile-info-item"><strong>Firma:</strong> ${customerData.companyName}</div>
                <div class="profile-info-item"><strong>Typ:</strong> ${typeText}</div>
                <div class="profile-info-item"><strong>Branche:</strong> ${industryText}</div>
                <div class="profile-info-item"><strong>Kontakt:</strong> ${customerData.contactName}</div>
                <div class="profile-info-item"><strong>Position:</strong> ${customerData.contactPosition || 'N/A'}</div>
                <div class="profile-info-item"><strong>E-Mail:</strong> ${customerData.contactEmail}</div>
                <div class="profile-info-item"><strong>Telefon:</strong> ${customerData.contactPhone}</div>
                <div class="profile-info-item"><strong>Standort:</strong> ${customerData.zipCode} ${customerData.city}</div>
            `;
        }

        function generatePotentialAnalysis() {
            const container = document.getElementById('profilePotential');
            const targetRevenue = customerData.targetRevenue || 0;
            const discount = calculateCustomerDiscount();
            const savings = targetRevenue * (discount / 100);
            
            container.innerHTML = `
                <div class="potential-metrics">
                    <div class="metric-item">
                        <span>${getTranslation('profile.targetVolume')}:</span>
                        <span class="metric-value">${formatCurrency(targetRevenue)}</span>
                    </div>
                    <div class="metric-item">
                        <span>${getTranslation('profile.savingsPotential')}:</span>
                        <span class="metric-value">${formatCurrency(savings)}</span>
                    </div>
                    <div class="metric-item">
                        <span>${getTranslation('profile.contractValue')}:</span>
                        <span class="metric-value">${formatCurrency(targetRevenue - savings)}</span>
                    </div>
                </div>
            `;
            
            // Add vending potential if interested
            if (customerData.vendingInterest) {
                const vendingRevenue = customerData.vendingLocations * customerData.vendingDaily * 10 * 250; // 10‚Ç¨ average, 250 days
                container.innerHTML += `
                    <div class="info-box" style="margin-top: 1rem;">
                        <h4>Vending-Potenzial</h4>
                        <p>Zus√§tzliches Umsatzpotenzial: ${formatCurrency(vendingRevenue)}/Jahr</p>
                    </div>
                `;
            }
        }

        function generateSalesStrategy() {
            const container = document.getElementById('profileStrategy');
            const strategy = getIndustryStrategy(customerData.industry);
            
            container.innerHTML = `
                <div class="strategy-grid">
                    <div class="strategy-section">
                        <h4>${getTranslation('profile.decisionCriteria')}</h4>
                        <ul>${strategy.criteria.map(c => `<li>${c}</li>`).join('')}</ul>
                    </div>
                    <div class="strategy-section">
                        <h4>${getTranslation('profile.painPoints')}</h4>
                        <ul>${strategy.painPoints.map(p => `<li>${p}</li>`).join('')}</ul>
                    </div>
                    <div class="strategy-section">
                        <h4>${getTranslation('profile.opportunities')}</h4>
                        <ul>${strategy.opportunities.map(o => `<li>${o}</li>`).join('')}</ul>
                    </div>
                    <div class="strategy-section">
                        <h4>${getTranslation('profile.competitiveAdvantage')}</h4>
                        <ul>${strategy.advantages.map(a => `<li>${a}</li>`).join('')}</ul>
                    </div>
                </div>
            `;
        }

        function generateKeyArguments() {
            const container = document.getElementById('profileArguments');
            const arguments = getKeyArguments();
            
            container.innerHTML = `
                <div class="arguments-list">
                    ${arguments.map((arg, index) => `
                        <div class="argument-item">
                            <div class="argument-number">${index + 1}</div>
                            <div>
                                <strong>${arg.title}</strong>
                                <p>${arg.description}</p>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function generateNextSteps() {
            const container = document.getElementById('profileNextSteps');
            
            container.innerHTML = `
                <div class="steps-timeline">
                    <div class="step-item active">
                        <div class="step-marker">1</div>
                        <div class="step-content">
                            <strong>Erstkontakt</strong><br>
                            <small>Bedarfsanalyse</small>
                        </div>
                    </div>
                    <div class="step-item">
                        <div class="step-marker">2</div>
                        <div class="step-content">
                            <strong>Demo</strong><br>
                            <small>Rabatt-Demonstrator</small>
                        </div>
                    </div>
                    <div class="step-item">
                        <div class="step-marker">3</div>
                        <div class="step-content">
                            <strong>Angebot</strong><br>
                            <small>Individualisiert</small>
                        </div>
                    </div>
                    <div class="step-item">
                        <div class="step-marker">4</div>
                        <div class="step-content">
                            <strong>Verhandlung</strong><br>
                            <small>Konditionen</small>
                        </div>
                    </div>
                    <div class="step-item">
                        <div class="step-marker">5</div>
                        <div class="step-content">
                            <strong>Abschluss</strong><br>
                            <small>Vertragsunterzeichnung</small>
                        </div>
                    </div>
                </div>
                
                <div class="info-box" style="margin-top: 2rem;">
                    <h4>Empfohlene n√§chste Aktion</h4>
                    <p>${getRecommendedAction()}</p>
                </div>
            `;
        }

        function calculateCustomerDiscount() {
            const revenue = customerData.targetRevenue || 0;
            let discount = 0;
            
            if (revenue >= 75000) discount = 10;
            else if (revenue >= 50000) discount = 9;
            else if (revenue >= 30000) discount = 8;
            else if (revenue >= 15000) discount = 6;
            else if (revenue >= 5000) discount = 3;
            
            // Add potential bonuses
            if (customerData.customerType === 'chain') discount += 1;
            
            return discount;
        }

        function getIndustryStrategy(industry) {
            const strategies = {
                hotel: {
                    criteria: ['Qualit√§t & Frische', 'Flexibilit√§t bei Bestellmengen', 'Zuverl√§ssige Lieferung'],
                    painPoints: ['Schwankende Auslastung', 'Hohe Personalkosten', 'Food Waste'],
                    opportunities: ['Cook&Fresh f√ºr Room Service', 'Flexible Kombi-Bestellungen', 'Fr√ºhst√ºcks-Komplettl√∂sungen'],
                    advantages: ['12 Monate Preisstabilit√§t', 'Keine Mindestabnahme', 'Rabatte ab 5.000‚Ç¨']
                },
                altenheim: {
                    criteria: ['Konsistenzanpassung', 'Di√§tformen-Vielfalt', 'Einfache Zubereitung'],
                    painPoints: ['Fachkr√§ftemangel K√ºche', 'Steigende Lebensmittelkosten', 'Hygiene-Anforderungen'],
                    opportunities: ['Komplette Men√ºlinien', 'Konsistenz-angepasste Produkte', 'Notfall-Vorrat'],
                    advantages: ['MDK-konforme Produkte', 'Transparente Allergenkennzeichnung', 'Schulungsangebote']
                },
                krankenhaus: {
                    criteria: ['Hygiene & Sicherheit', 'Kosteneffizienz', 'Patientenzufriedenheit'],
                    painPoints: ['Kostendruck', 'Unterschiedliche Kostformen', 'Personal-Engp√§sse'],
                    opportunities: ['Wahlleistung Premium-Men√ºs', 'Outsourcing Wochenend-K√ºche', 'Mitarbeiter-Catering'],
                    advantages: ['HACCP-zertifiziert', 'Individuelle Portionierung', 'Notfall-Lieferservice']
                },
                betriebsrestaurant: {
                    criteria: ['Attraktive Preise', 'Abwechslung', 'Moderne Gerichte'],
                    painPoints: ['Mitarbeiterzufriedenheit', 'Subventionsdruck', 'Trend-Anforderungen'],
                    opportunities: ['Vending als Erg√§nzung', 'Aktionswochen', 'Gesundheitsprogramme'],
                    advantages: ['Mengenrabatte optimal nutzen', 'Trend-Produkte im Portfolio', 'Marketing-Unterst√ºtzung']
                },
                restaurant: {
                    criteria: ['Konstante Qualit√§t', 'Faire Preise', 'Innovations-Partner'],
                    painPoints: ['Personalmangel', 'Schwankende G√§stezahlen', 'Margendruck'],
                    opportunities: ['Sous-Vide Premiumprodukte', 'Saisonale Spezialit√§ten', 'Convenience ohne Kompromisse'],
                    advantages: ['Kalkulationssicherheit', 'Kleine Verpackungseinheiten', 'Inspiration & Rezepte']
                }
            };
            
            return strategies[industry] || strategies.restaurant;
        }

        function getKeyArguments() {
            return [
                {
                    title: 'Garantierte Preisstabilit√§t',
                    description: '12 Monate keine Preiserh√∂hung - volle Planungssicherheit f√ºr Ihr Budget'
                },
                {
                    title: 'Keine Mindestabnahme',
                    description: 'Bestellen Sie nur was Sie brauchen - das Zielvolumen ist unverbindlich'
                },
                {
                    title: 'Transparentes Rabattsystem',
                    description: 'Je mehr Sie bestellen, desto mehr sparen Sie - bis zu 13% Gesamtrabatt m√∂glich'
                },
                {
                    title: 'Flexibilit√§t bei Gro√übestellungen',
                    description: 'Kombi-Lieferungen ab 30.000‚Ç¨ - teilen Sie auf 2 Termine auf'
                },
                {
                    title: 'Pers√∂nlicher Ansprechpartner',
                    description: 'Ihr dedizierter Betreuer kennt Ihre Bed√ºrfnisse und ist immer erreichbar'
                }
            ];
        }

        function getRecommendedAction() {
            const revenue = customerData.targetRevenue || 0;
            const isChain = customerData.customerType === 'chain';
            
            if (revenue >= 50000) {
                return 'Vereinbaren Sie einen Vor-Ort-Termin zur Bestandsaufnahme und Gro√ükunden-Beratung.';
            } else if (isChain) {
                return 'Pr√§sentieren Sie die Vorteile der Kettenb√ºndelung mit zentraler Abrechnung.';
            } else if (revenue >= 15000) {
                return 'F√ºhren Sie eine Live-Demo des Rabatt-Systems durch und zeigen Sie das Einsparpotenzial.';
            } else {
                return 'Starten Sie mit einer Testbestellung und bauen Sie das Vertrauen schrittweise auf.';
            }
        }

        function getIndustryName(industry) {
            const names = {
                hotel: 'Hotel',
                altenheim: 'Alten-/Pflegeheim',
                krankenhaus: 'Krankenhaus/Klinik',
                betriebsrestaurant: 'Betriebsrestaurant',
                restaurant: 'Restaurant/Caterer'
            };
            return names[industry] || industry;
        }

        // Offer Generation
        function generateOffer() {
            // Validate required fields
            if (!customerData.companyName) {
                showMessage(getTranslation('messages.fillCustomerFirst'), 'error');
                switchTab('customer');
                return;
            }
            
            const salespersonName = document.getElementById('salespersonName').value;
            const salespersonEmail = document.getElementById('salespersonEmail').value;
            
            if (!salespersonName || !salespersonEmail) {
                showMessage(getTranslation('messages.fillSalespersonInfo'), 'error');
                return;
            }
            
            showMessage(getTranslation('messages.pdfGenerating'), 'success');
            
            // Generate PDF
            generatePDF();
        }

        function generatePDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Set fonts
            doc.setFont('helvetica');
            
            // Page 1: Cover Letter
            addCoverLetter(doc);
            
            // Page 2: Partnership Agreement
            if (document.getElementById('docPartnership').checked) {
                doc.addPage();
                addPartnershipAgreement(doc);
            }
            
            // Page 3: Discount System
            if (document.getElementById('docRabatt').checked) {
                doc.addPage();
                addDiscountSystem(doc);
            }
            
            // Page 4: Calculation Examples
            if (document.getElementById('docCalc').checked) {
                doc.addPage();
                addCalculationExamples(doc);
            }
            
            // Save the PDF
            const pdfBlob = doc.output('blob');
            const pdfUrl = URL.createObjectURL(pdfBlob);
            
            // Store generated PDF
            generatedPdf = {
                blob: pdfBlob,
                url: pdfUrl,
                filename: `FreshPlan_Angebot_${customerData.companyName.replace(/[^a-z0-9]/gi, '_')}_${new Date().toISOString().split('T')[0]}.pdf`
            };
            
            // Show preview
            showPdfPreview();
            
            // Update progress
            tabProgress.offer = true;
            updateProgress();
        }

        function addCoverLetter(doc) {
            const contractStart = document.getElementById('contractStart').value;
            const salespersonName = document.getElementById('salespersonName').value;
            const salespersonEmail = document.getElementById('salespersonEmail').value;
            const salespersonPhone = document.getElementById('salespersonPhone').value || '';
            const additionalNotes = document.getElementById('additionalNotes').value;
            
            // Header
            doc.setFontSize(24);
            doc.setTextColor(127, 176, 105);
            doc.text('FreshPlan', 20, 30);
            doc.setFontSize(14);
            doc.setTextColor(0, 0, 0);
            doc.text('Ihre Partnerschaft f√ºr Erfolg', 20, 40);
            
            // Date
            doc.setFontSize(10);
            doc.text(new Date().toLocaleDateString('de-DE'), 170, 30);
            
            // Address
            doc.setFontSize(11);
            doc.text(customerData.companyName, 20, 60);
            doc.text(customerData.contactName, 20, 66);
            doc.text(customerData.street, 20, 72);
            doc.text(`${customerData.zipCode} ${customerData.city}`, 20, 78);
            
            // Subject
            doc.setFontSize(14);
            doc.setFont('helvetica', 'bold');
            doc.text('Ihr individuelles FreshPlan-Angebot', 20, 100);
            
            // Salutation
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(11);
            const salutation = `Sehr geehrte/r ${customerData.contactName},`;
            doc.text(salutation, 20, 115);
            
            // Body text
            const bodyText = [
                'vielen Dank f√ºr Ihr Interesse an unserer FreshPlan-Partnerschaft.',
                '',
                `Basierend auf Ihrem geplanten Jahresvolumen von ${formatCurrency(customerData.targetRevenue)}`,
                `k√∂nnen Sie mit unserem transparenten Rabattsystem bis zu ${calculateCustomerDiscount()}% sparen.`,
                '',
                'Die Vorteile Ihrer FreshPlan-Partnerschaft:',
                '‚Ä¢ Garantierte Preisstabilit√§t f√ºr 12 Monate',
                '‚Ä¢ Keine Mindestabnahmeverpflichtung',
                '‚Ä¢ Flexible Bestellm√∂glichkeiten',
                '‚Ä¢ Pers√∂nliche Betreuung',
                '',
                'Vertragsbeginn: ' + new Date(contractStart).toLocaleDateString('de-DE'),
                'Laufzeit: 12 Monate mit automatischer Verl√§ngerung'
            ];
            
            let yPosition = 125;
            bodyText.forEach(line => {
                doc.text(line, 20, yPosition);
                yPosition += 6;
            });
            
            // Additional notes if any
            if (additionalNotes) {
                yPosition += 6;
                doc.text('Zus√§tzliche Vereinbarungen:', 20, yPosition);
                yPosition += 6;
                const notes = doc.splitTextToSize(additionalNotes, 170);
                notes.forEach(line => {
                    doc.text(line, 20, yPosition);
                    yPosition += 6;
                });
            }
            
            // Signature
            yPosition = 250;
            doc.text('Mit freundlichen Gr√º√üen', 20, yPosition);
            doc.text(salespersonName, 20, yPosition + 10);
            if (salespersonPhone) {
                doc.text(`Tel: ${salespersonPhone}`, 20, yPosition + 16);
            }
            doc.text(`E-Mail: ${salespersonEmail}`, 20, yPosition + 22);
        }

        function addPartnershipAgreement(doc) {
            doc.setFontSize(18);
            doc.setFont('helvetica', 'bold');
            doc.text('FreshPlan-Partnerschaftsvereinbarung', 20, 30);
            
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(11);
            
            const agreementText = [
                'zwischen',
                '',
                'Freshfoodz GmbH',
                'Musterstra√üe 123',
                '12345 Musterstadt',
                '',
                'und',
                '',
                customerData.companyName,
                customerData.street,
                `${customerData.zipCode} ${customerData.city}`,
                '',
                '¬ß1 Vertragsgegenstand',
                'Diese Vereinbarung regelt die Konditionen f√ºr den Bezug von Lebensmitteln',
                'und Convenience-Produkten im Rahmen des FreshPlan-Programms.',
                '',
                '¬ß2 Zielvolumen',
                `Das unverbindliche Zielvolumen betr√§gt ${formatCurrency(customerData.targetRevenue)} netto pro Jahr.`,
                'Es besteht keine Mindestabnahmeverpflichtung.',
                '',
                '¬ß3 Rabattvereinbarung',
                'Es gelten die Rabattstaffeln gem√§√ü Anlage 1.',
                'Die Rabatte werden bei jeder Bestellung automatisch ber√ºcksichtigt.',
                '',
                '¬ß4 Preisstabilit√§t',
                'Die vereinbarten Preise bleiben f√ºr 12 Monate stabil.',
                'Preisanpassungen erfolgen nur bei Rohstoffpreissteigerungen >5%.',
                '',
                '¬ß5 Laufzeit',
                'Die Vereinbarung beginnt am ' + new Date(document.getElementById('contractStart').value).toLocaleDateString('de-DE'),
                'und l√§uft 12 Monate. Sie verl√§ngert sich automatisch um weitere 12 Monate,',
                'sofern nicht 3 Monate vor Ablauf gek√ºndigt wird.'
            ];
            
            let yPosition = 50;
            agreementText.forEach(line => {
                if (line.startsWith('¬ß')) {
                    doc.setFont('helvetica', 'bold');
                } else {
                    doc.setFont('helvetica', 'normal');
                }
                doc.text(line, 20, yPosition);
                yPosition += 6;
            });
            
            // Signature fields
            yPosition = 240;
            doc.line(20, yPosition, 80, yPosition);
            doc.line(110, yPosition, 170, yPosition);
            doc.text('Ort, Datum', 20, yPosition + 5);
            doc.text('Ort, Datum', 110, yPosition + 5);
            
            doc.line(20, yPosition + 20, 80, yPosition + 20);
            doc.line(110, yPosition + 20, 170, yPosition + 20);
            doc.text('Freshfoodz GmbH', 20, yPosition + 25);
            doc.text(customerData.companyName, 110, yPosition + 25);
        }

        function addDiscountSystem(doc) {
            doc.setFontSize(18);
            doc.setFont('helvetica', 'bold');
            doc.text('Anlage 1: Rabattsystem', 20, 30);
            
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(12);
            doc.text('Transparente Konditionen f√ºr Ihren Erfolg', 20, 40);
            
            // Discount table
            const tableData = [
                ['Bestellwert (netto)', 'Basisrabatt'],
                ['ab 5.000 ‚Ç¨', '3%'],
                ['ab 15.000 ‚Ç¨', '6%'],
                ['ab 30.000 ‚Ç¨', '8%'],
                ['ab 50.000 ‚Ç¨', '9%'],
                ['ab 75.000 ‚Ç¨', '10%']
            ];
            
            doc.autoTable({
                head: [tableData[0]],
                body: tableData.slice(1),
                startY: 50,
                theme: 'grid',
                headStyles: { fillColor: [127, 176, 105] },
                margin: { left: 20 }
            });
            
            // Additional discounts
            const additionalY = doc.lastAutoTable.finalY + 20;
            doc.setFont('helvetica', 'bold');
            doc.text('Zus√§tzliche Rabatte:', 20, additionalY);
            
            doc.setFont('helvetica', 'normal');
            const additionalDiscounts = [
                'Fr√ºhbucherrabatt:',
                '‚Ä¢ 10-14 Tage Vorlauf: +1%',
                '‚Ä¢ 15-29 Tage Vorlauf: +2%',
                '‚Ä¢ 30-44 Tage Vorlauf: +3%',
                '',
                'Selbstabholung:',
                '‚Ä¢ Bei Bestellwert ab 5.000‚Ç¨: +2%',
                '',
                'Maximal m√∂glicher Gesamtrabatt: 15%'
            ];
            
            let yPos = additionalY + 10;
            additionalDiscounts.forEach(line => {
                doc.text(line, 20, yPos);
                yPos += 7;
            });
            
            // Special conditions
            doc.setFont('helvetica', 'bold');
            doc.text('Besondere Konditionen:', 20, yPos + 10);
            
            doc.setFont('helvetica', 'normal');
            const specialConditions = [
                '‚Ä¢ Kombi-Bestellung: Ab 30.000‚Ç¨ Aufteilung auf 2 Liefertermine m√∂glich',
                '‚Ä¢ Kettenkunden: W√∂chentliche Sammelbestellungen f√ºr h√∂here Rabattstufen',
                '‚Ä¢ Keine Mindestbestellmenge pro Auftrag',
                '‚Ä¢ Kostenlose Lieferung ab 250‚Ç¨ Bestellwert'
            ];
            
            yPos += 20;
            specialConditions.forEach(line => {
                doc.text(line, 20, yPos);
                yPos += 7;
            });
        }

        function addCalculationExamples(doc) {
            doc.setFontSize(18);
            doc.setFont('helvetica', 'bold');
            doc.text('Ihre individuelle Kalkulation', 20, 30);
            
            const revenue = customerData.targetRevenue || 0;
            const avgOrderValue = revenue / 52; // Weekly orders
            const discount = calculateCustomerDiscount();
            
            // Scenario 1: Regular order
            doc.setFontSize(14);
            doc.text('Szenario 1: W√∂chentliche Regelbestellung', 20, 50);
            
            doc.setFontSize(11);
            doc.setFont('helvetica', 'normal');
            const scenario1 = [
                `Durchschnittlicher Bestellwert: ${formatCurrency(avgOrderValue)}`,
                `Basisrabatt: ${discount}%`,
                `Ihre Ersparnis pro Bestellung: ${formatCurrency(avgOrderValue * discount / 100)}`,
                `Jahresersparnis: ${formatCurrency(revenue * discount / 100)}`
            ];
            
            let yPos = 60;
            scenario1.forEach(line => {
                doc.text(line, 25, yPos);
                yPos += 7;
            });
            
            // Scenario 2: Optimized order
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(14);
            doc.text('Szenario 2: Optimierte Bestellung mit Vorlauf', 20, yPos + 10);
            
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(11);
            const optimizedDiscount = Math.min(discount + 3, 15); // With early booking
            const scenario2 = [
                `Bestellung mit 30 Tagen Vorlauf`,
                `Basisrabatt: ${discount}%`,
                `Fr√ºhbucherbonus: +3%`,
                `Gesamtrabatt: ${optimizedDiscount}%`,
                `Zus√§tzliche Jahresersparnis: ${formatCurrency(revenue * 3 / 100)}`
            ];
            
            yPos += 20;
            scenario2.forEach(line => {
                doc.text(line, 25, yPos);
                yPos += 7;
            });
            
            // Summary box
            const summaryY = yPos + 20;
            doc.setFillColor(127, 176, 105, 0.1);
            doc.rect(20, summaryY, 170, 40, 'F');
            
            doc.setFont('helvetica', 'bold');
            doc.text('Ihr Einsparpotenzial auf einen Blick:', 30, summaryY + 10);
            
            doc.setFontSize(16);
            doc.text(`Bis zu ${formatCurrency(revenue * optimizedDiscount / 100)} pro Jahr!`, 30, summaryY + 25);
            
            // Call to action
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(11);
            doc.text('Starten Sie jetzt und sichern Sie sich Ihre Vorteile!', 30, summaryY + 35);
        }

        function showPdfPreview() {
            const modal = document.getElementById('pdfModal');
            const frame = document.getElementById('pdfFrame');
            
            frame.src = generatedPdf.url;
            modal.style.display = 'block';
            
            showMessage(getTranslation('messages.offerCreated'), 'success');
        }

        function closePdfModal() {
            document.getElementById('pdfModal').style.display = 'none';
        }

        function downloadPdf() {
            const link = document.createElement('a');
            link.href = generatedPdf.url;
            link.download = generatedPdf.filename;
            link.click();
        }

        function sendOffer() {
            if (!generatedPdf) {
                showMessage('Bitte erst PDF generieren!', 'error');
                return;
            }
            
            if (!customerData.contactEmail) {
                showMessage(getTranslation('messages.noEmailAddress'), 'error');
                return;
            }
            
            // Since we can't actually send emails from the browser,
            // we'll open the default email client
            const subject = encodeURIComponent(`Ihr FreshPlan-Angebot - ${customerData.companyName}`);
            const body = encodeURIComponent(`Sehr geehrte/r ${customerData.contactName},\n\nanbei erhalten Sie Ihr individuelles FreshPlan-Angebot.\n\nBei Fragen stehe ich Ihnen gerne zur Verf√ºgung.\n\nMit freundlichen Gr√º√üen\n${document.getElementById('salespersonName').value}`);
            
            window.location.href = `mailto:${customerData.contactEmail}?subject=${subject}&body=${body}`;
            
            showMessage(getTranslation('messages.emailOpened'), 'success');
        }

        function printOffer() {
            if (!generatedPdf) {
                showMessage('Bitte erst PDF generieren!', 'error');
                return;
            }
            
            // Open PDF in new window for printing
            const printWindow = window.open(generatedPdf.url, '_blank');
            if (printWindow) {
                printWindow.onload = function() {
                    printWindow.print();
                };
            }
        }

        // Settings Functions
        function loadSettings() {
            const settings = storage.getItem('freshplanSettings');
            if (settings) {
                const data = JSON.parse(settings);
                
                // Apply settings to fields
                if (data.defaultSalesperson) {
                    Object.keys(data.defaultSalesperson).forEach(key => {
                        const field = document.getElementById(key);
                        if (field) field.value = data.defaultSalesperson[key];
                    });
                }
                
                if (data.monday) {
                    if (data.monday.token) document.getElementById('mondayToken').value = data.monday.token;
                    if (data.monday.boardId) document.getElementById('mondayBoardId').value = data.monday.boardId;
                }
                
                if (data.email) {
                    if (data.email.server) document.getElementById('smtpServer').value = data.email.server;
                    if (data.email.email) document.getElementById('smtpEmail').value = data.email.email;
                    if (data.email.password) document.getElementById('smtpPassword').value = data.email.password;
                }
                
                if (data.xentral) {
                    if (data.xentral.url) document.getElementById('xentralUrl').value = data.xentral.url;
                    if (data.xentral.key) document.getElementById('xentralKey').value = data.xentral.key;
                }
            }
        }

        function loadDefaultSalesperson() {
            const settings = storage.getItem('freshplanSettings');
            if (settings) {
                const data = JSON.parse(settings);
                if (data.defaultSalesperson) {
                    const nameField = document.getElementById('salespersonName');
                    const emailField = document.getElementById('salespersonEmail');
                    const phoneField = document.getElementById('salespersonPhone');
                    const mobileField = document.getElementById('salespersonMobile');
                    
                    if (nameField && !nameField.value && data.defaultSalesperson.defaultSalespersonName) {
                        nameField.value = data.defaultSalesperson.defaultSalespersonName;
                    }
                    if (emailField && !emailField.value && data.defaultSalesperson.defaultSalespersonEmail) {
                        emailField.value = data.defaultSalesperson.defaultSalespersonEmail;
                    }
                    if (phoneField && !phoneField.value && data.defaultSalesperson.defaultSalespersonPhone) {
                        phoneField.value = data.defaultSalesperson.defaultSalespersonPhone;
                    }
                    if (mobileField && !mobileField.value && data.defaultSalesperson.defaultSalespersonMobile) {
                        mobileField.value = data.defaultSalesperson.defaultSalespersonMobile;
                    }
                }
            }
        }

        function saveSettings() {
            const settings = {
                defaultSalesperson: {
                    defaultSalespersonName: document.getElementById('defaultSalespersonName').value,
                    defaultSalespersonEmail: document.getElementById('defaultSalespersonEmail').value,
                    defaultSalespersonPhone: document.getElementById('defaultSalespersonPhone').value,
                    defaultSalespersonMobile: document.getElementById('defaultSalespersonMobile').value
                },
                monday: {
                    token: document.getElementById('mondayToken').value,
                    boardId: document.getElementById('mondayBoardId').value
                },
                email: {
                    server: document.getElementById('smtpServer').value,
                    email: document.getElementById('smtpEmail').value,
                    password: document.getElementById('smtpPassword').value
                },
                xentral: {
                    url: document.getElementById('xentralUrl').value,
                    key: document.getElementById('xentralKey').value
                }
            };
            
            storage.setItem('freshplanSettings', JSON.stringify(settings));
            showMessage(getTranslation('messages.settingsSaved'), 'success');
        }

        function testMondayConnection() {
            const token = document.getElementById('mondayToken').value;
            
            if (!token) {
                showMessage(getTranslation('messages.missingAPIToken'), 'error');
                return;
            }
            
            // Simulate API test
            showMessage('Teste Verbindung...', 'success');
            
            setTimeout(() => {
                // In a real implementation, this would make an actual API call
                showMessage(getTranslation('messages.connectionSuccess'), 'success');
            }, 1000);
        }

        function syncPriceLists() {
            const url = document.getElementById('xentralUrl').value;
            const key = document.getElementById('xentralKey').value;
            
            if (!url || !key) {
                showMessage(getTranslation('messages.missingXentralData'), 'error');
                return;
            }
            
            showMessage(getTranslation('messages.syncInProgress'), 'success');
            
            setTimeout(() => {
                // In a real implementation, this would sync with Xentral
                showMessage(getTranslation('messages.syncSuccess'), 'success');
            }, 2000);
        }

        // Contract date handling
        function updateContractEnd() {
            const startDate = document.getElementById('contractStart').value;
            if (startDate) {
                const endDate = new Date(startDate);
                endDate.setFullYear(endDate.getFullYear() + 1);
                endDate.setDate(endDate.getDate() - 1);
                document.getElementById('contractEnd').value = endDate.toISOString().split('T')[0];
            }
        }

        // Document Upload Handling
        function handleDocumentUpload(type, input) {
            const file = input.files[0];
            if (file) {
                // Store file reference
                uploadedDocuments[type] = file;
                
                // Show success indicator
                document.getElementById(type + 'Status').style.display = 'inline';
                
                showMessage(`${file.name} wurde hochgeladen`, 'success');
            }
        }

        function resetDocuments() {
            uploadedDocuments = {
                partnership: null,
                rabatt: null,
                agb: null
            };
            
            // Hide all status indicators
            ['partnership', 'rabatt', 'agb'].forEach(type => {
                document.getElementById(type + 'Status').style.display = 'none';
            });
            
            // Clear file inputs
            document.getElementById('uploadPartnership').value = '';
            document.getElementById('uploadRabatt').value = '';
            document.getElementById('uploadAGB').value = '';
            
            showMessage('Standard-Dokumente werden verwendet', 'success');
        }

        // Language Switching
        function initializeLanguageSwitcher() {
            const langButtons = document.querySelectorAll('.lang-btn');
            langButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    langButtons.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentLang = this.getAttribute('data-lang');
                    updateLanguage();
                });
            });
        }

        function updateLanguage() {
            // Update all elements with data-lang-key
            document.querySelectorAll('[data-lang-key]').forEach(element => {
                const key = element.getAttribute('data-lang-key');
                const translation = getTranslation(key);
                if (translation) {
                    element.textContent = translation;
                }
            });
            
            // Update placeholders and other attributes as needed
            updatePlaceholders();
        }

        function updatePlaceholders() {
            // Update specific placeholders based on language
            const placeholders = {
                'location-name-': currentLang === 'de' ? 'z.B. Hotel Berlin' : 'e.g. Hotel Berlin'
            };
            
            // Apply placeholders
            Object.keys(placeholders).forEach(id => {
                const elements = document.querySelectorAll(`[id^="${id}"]`);
                elements.forEach(el => {
                    if (el) el.placeholder = placeholders[id];
                });
            });
        }

        function getTranslation(key) {
            const keys = key.split('.');
            let value = translations[currentLang];
            
            for (const k of keys) {
                if (value && value[k]) {
                    value = value[k];
                } else {
                    return key; // Return key if translation not found
                }
            }
            
            return value;
        }

        // Utility Functions
        function formatCurrency(amount) {
            return new Intl.NumberFormat('de-DE', {
                style: 'currency',
                currency: 'EUR',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(amount);
        }

        function showMessage(message, type) {
            const messageEl = document.getElementById(type + 'Message');
            if (messageEl) {
                messageEl.textContent = message;
                messageEl.classList.add('show');
                
                setTimeout(() => {
                    messageEl.classList.remove('show');
                }, 3000);
            }
        }

        // Load autosaved data on page load
        window.addEventListener('load', function() {
            setTimeout(() => {
                try {
                    loadAutosavedData();
                } catch (e) {
                    console.warn('Could not load autosaved data:', e);
                }
            }, 500);
        });
    </script>
</body>
</html>